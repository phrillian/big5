<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>42life Premium</title>
    
    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }

        :root {
            --primary: #FF9966;
            --primary-dark: #FF7744;
            --gradient-bg: linear-gradient(135deg, #E8E4F3 0%, #E1DDF0 25%, #F5E6F0 50%, #E8E4F3 100%);
            --text-primary: #2D3142;
            --text-secondary: #75758B;
            --text-tertiary: #B4B4C8;
            --glass-bg: rgba(255, 255, 255, 0.7);
            --glass-border: rgba(255, 255, 255, 0.5);
            --shadow: 0 8px 32px rgba(149, 157, 165, 0.15);
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: var(--gradient-bg);
            background-attachment: fixed;
            color: var(--text-primary);
            line-height: 1.4;
            -webkit-font-smoothing: antialiased;
            padding-bottom: 80px;
            min-height: 100vh;
        }

        /* GLASSMORPHISM CARD */
        .glass-card {
            background: var(--glass-bg);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border-radius: 24px;
            border: 1px solid var(--glass-border);
            box-shadow: var(--shadow);
            padding: 20px;
            transition: transform 0.2s;
        }

        .glass-card:active {
            transform: scale(0.98);
        }

        /* HEADER */
        .header {
            padding: 60px 20px 24px;
        }

        .header-title {
            font-size: 34px;
            font-weight: 700;
            margin-bottom: 8px;
            letter-spacing: -0.5px;
        }

        .header-subtitle {
            font-size: 17px;
            color: var(--text-secondary);
        }

        /* TABS */
        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        /* BIG 5 OVERVIEW */
        .big5-grid {
            display: grid;
            gap: 12px;
            padding: 0 20px 20px;
        }

        .big5-card {
            cursor: pointer;
        }

        .big5-header {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 16px;
        }

        .big5-icon {
            width: 48px;
            height: 48px;
            background: linear-gradient(135deg, var(--primary), var(--primary-dark));
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            cursor: pointer;
            transition: transform 0.2s;
        }

        .big5-icon:hover {
            transform: scale(1.05);
        }

        .big5-info {
            flex: 1;
        }

        .big5-name {
            font-size: 17px;
            font-weight: 600;
            margin-bottom: 2px;
        }

        .big5-level {
            font-size: 13px;
            color: var(--primary);
            font-weight: 700;
        }

        .level-up-btn {
            background: var(--primary);
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 12px;
            font-size: 13px;
            font-weight: 600;
            cursor: pointer;
        }

        .big5-progress {
            margin-top: 12px;
        }

        .progress-label {
            font-size: 12px;
            color: var(--text-secondary);
            margin-bottom: 6px;
        }

        .progress-bar {
            height: 6px;
            background: rgba(149, 157, 165, 0.2);
            border-radius: 3px;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--primary-dark), var(--primary));
            border-radius: 3px;
            transition: width 0.3s ease;
        }

        /* LIFE WHEEL */
        .wheel-section {
            padding: 20px;
        }

        .wheel-canvas-wrapper {
            max-width: 500px;
            width: 100%;
            margin: 0 auto 24px;
            background: var(--glass-bg);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border-radius: 24px;
            border: 1px solid var(--glass-border);
            padding: 24px;
            box-shadow: var(--shadow);
            position: relative;
        }

        .wheel-canvas-wrapper canvas {
            width: 100% !important;
            height: auto !important;
        }

        .wheel-icons-overlay {
            position: absolute;
            top: 24px;
            left: 24px;
            right: 24px;
            bottom: 24px;
            pointer-events: none;
        }

        .wheel-icon {
            position: absolute;
            transform: translate(-50%, -50%);
        }

        /* RAINBOW WHEEL */
        .rainbow-wheel-section {
            padding: 20px;
            display: flex;
            justify-content: center;
            margin-bottom: 20px;
        }

        .rainbow-wheel-container {
            position: relative;
            width: 400px;
            height: 400px;
            max-width: 90vw;
            max-height: 90vw;
        }

        #rainbowWheelCanvas {
            width: 100%;
            height: 100%;
            filter: drop-shadow(0 8px 32px rgba(0, 0, 0, 0.1));
        }

        .rainbow-wheel-icons {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
        }

        .rainbow-icon {
            position: absolute;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            background: white;
            border-radius: 50%;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            transform: translate(-50%, -50%);
        }

        .life-grid {
            display: grid;
            grid-template-columns: 1fr;
            gap: 12px;
            padding: 0 20px 20px;
        }

        .life-card {
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
            overflow: visible;
        }

        .life-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 12px 48px rgba(0, 0, 0, 0.1);
        }

        .life-card.expanded {
            cursor: default;
        }

        .life-card-main {
            display: flex;
            align-items: center;
            gap: 16px;
            margin-bottom: 12px;
        }

        .life-card-ring {
            flex-shrink: 0;
        }

        .life-card-info {
            flex: 1;
            min-width: 0;
        }

        .life-card-name {
            font-size: 17px;
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 4px;
            display: flex;
            align-items: center;
        }

        .life-card-values {
            font-size: 24px;
            font-weight: 700;
            color: var(--text-primary);
            margin-bottom: 4px;
        }

        .life-card-target-small {
            font-size: 13px;
            color: var(--text-secondary);
        }

        .life-card-controls {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-top: 12px;
        }

        .life-card-trend {
            flex-shrink: 0;
        }

        .life-card-content {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.3s ease;
        }

        .life-card.expanded .life-card-content {
            max-height: 500px;
        }

        .activities-section {
            margin-top: 16px;
            padding-top: 16px;
            border-top: 1px solid rgba(149, 157, 165, 0.1);
        }

        .activity-item-saved {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 10px 12px;
            background: rgba(149, 157, 165, 0.05);
            border-radius: 10px;
            margin-bottom: 8px;
        }

        .activity-text {
            flex: 1;
            font-size: 14px;
            color: var(--text-primary);
        }

        .activity-actions {
            display: flex;
            gap: 8px;
            margin-left: 12px;
        }

        .activity-edit-icon,
        .activity-delete-icon {
            color: var(--text-tertiary);
            cursor: pointer;
            width: 16px;
            height: 16px;
            transition: color 0.2s;
        }

        .activity-edit-icon:hover {
            color: var(--primary);
        }

        .activity-delete-icon:hover {
            color: #FF3B30;
        }

        .activity-item-editing {
            display: flex;
            gap: 8px;
            margin-bottom: 12px;
        }

        .activity-input {
            flex: 1;
            padding: 10px 12px;
            border: 2px solid var(--primary);
            border-radius: 10px;
            font-size: 14px;
            outline: none;
        }

        .activity-save-btn,
        .activity-cancel-btn {
            width: 36px;
            height: 36px;
            border: none;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
        }

        .activity-save-btn {
            background: var(--primary);
            color: white;
        }

        .activity-cancel-btn {
            background: rgba(149, 157, 165, 0.1);
            color: var(--text-secondary);
        }

        .add-activity-btn {
            padding: 10px 12px;
            background: rgba(149, 157, 165, 0.08);
            border: none;
            border-radius: 10px;
            font-size: 13px;
            font-weight: 600;
            color: var(--text-secondary);
            cursor: pointer;
            width: 100%;
            margin-top: 8px;
            transition: background 0.2s;
        }

        .add-activity-btn:hover {
            background: rgba(149, 157, 165, 0.12);
        }

        .life-grid {
            display: grid;
            grid-template-columns: 1fr;
            gap: 12px;
            padding: 0 20px 20px;
        }

        .life-card {
            position: relative;
            overflow: hidden;
        }

        .blob-bg {
            position: absolute;
            width: 150%;
            height: 150%;
            top: -25%;
            right: -25%;
            opacity: 0.08;
            border-radius: 30% 70% 70% 30% / 30% 30% 70% 70%;
            z-index: 0;
        }

        .life-card > * {
            position: relative;
            z-index: 1;
        }

        .life-card-header {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-bottom: 12px;
        }

        .life-icon {
            font-size: 18px;
        }

        .life-title {
            font-size: 13px;
            font-weight: 600;
            color: var(--text-secondary);
        }

        .life-value {
            font-size: 42px;
            font-weight: 700;
            line-height: 1;
            margin-bottom: 6px;
        }

        .life-target {
            font-size: 11px;
            color: var(--text-tertiary);
            margin-bottom: 12px;
        }

        .life-controls {
            display: flex;
            flex-direction: column;
            gap: 12px;
            position: relative;
            z-index: 2;
        }

        .life-control-row {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .life-control-label {
            font-size: 12px;
            color: var(--text-secondary);
            font-weight: 600;
            min-width: 80px;
        }

        .life-slider {
            -webkit-appearance: none;
            flex: 1;
            height: 4px;
            border-radius: 2px;
            background: rgba(149, 157, 165, 0.2);
            outline: none;
        }

        .life-slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: var(--primary);
            cursor: grab;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        .life-slider::-moz-range-thumb {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: var(--primary);
            cursor: grab;
            border: none;
        }

        .life-value-badge {
            min-width: 40px;
            height: 32px;
            background: rgba(149, 157, 165, 0.1);
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 15px;
            font-weight: 700;
            color: var(--text-primary);
        }

        .life-target-input {
            width: 50px;
            height: 28px;
            padding: 0 6px;
            border: 2px solid rgba(149, 157, 165, 0.2);
            border-radius: 8px;
            font-size: 14px;
            font-weight: 600;
            text-align: center;
            background: white;
        }

        .life-target-input:focus {
            outline: none;
            border-color: var(--primary);
        }

        .life-value-badge {
            min-width: 36px;
            height: 28px;
            background: rgba(149, 157, 165, 0.1);
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 14px;
            font-weight: 600;
            color: var(--text-primary);
        }

        /* BOTTOM NAV */
        .bottom-nav {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: rgba(255, 255, 255, 0.8);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border-top: 1px solid var(--glass-border);
            display: flex;
            height: 80px;
            padding-bottom: env(safe-area-inset-bottom);
            box-shadow: 0 -4px 16px rgba(149, 157, 165, 0.1);
        }

        .nav-item {
            flex: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            gap: 4px;
            color: var(--text-secondary);
            font-size: 11px;
            font-weight: 500;
            cursor: pointer;
            border: none;
            background: transparent;
        }

        .nav-item.active {
            color: var(--primary);
        }

        /* MODAL */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.4);
            z-index: 10000;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }

        #iconModal {
            z-index: 20000;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background: white;
            border-radius: 20px;
            max-width: 400px;
            width: 100%;
            max-height: 80vh;
            overflow-y: auto;
        }

        .modal-header {
            padding: 24px 20px 16px;
            border-bottom: 1px solid rgba(149, 157, 165, 0.1);
        }

        .modal-title {
            font-size: 22px;
            font-weight: 700;
        }

        .modal-body {
            padding: 20px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            font-size: 14px;
        }

        .form-input {
            width: 100%;
            padding: 12px;
            border: 1px solid rgba(149, 157, 165, 0.2);
            border-radius: 12px;
            font-size: 16px;
        }

        .form-input:focus {
            outline: none;
            border-color: var(--primary);
        }

        .icon-grid {
            display: grid;
            grid-template-columns: repeat(6, 1fr);
            gap: 8px;
            max-height: 300px;
            overflow-y: auto;
        }

        .icon-option {
            aspect-ratio: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            border: 2px solid rgba(149, 157, 165, 0.1);
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .icon-option:hover {
            border-color: var(--primary);
            background: rgba(255, 153, 102, 0.05);
        }

        .icon-option.selected {
            border-color: var(--primary);
            background: rgba(255, 153, 102, 0.1);
        }

        .modal-actions {
            display: flex;
            gap: 12px;
            padding: 16px 20px;
            border-top: 1px solid rgba(149, 157, 165, 0.1);
        }

        .btn {
            flex: 1;
            padding: 14px;
            border-radius: 12px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            border: none;
        }

        .btn-secondary {
            background: rgba(149, 157, 165, 0.1);
            color: var(--text-primary);
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--primary), var(--primary-dark));
            color: white;
        }

        /* CONFETTI */
        @keyframes confettiFall {
            0% {
                opacity: 1;
                transform: translateY(-10vh) rotate(0deg);
            }
            100% {
                opacity: 0;
                transform: translateY(100vh) rotate(720deg);
            }
        }

        .confetti {
            position: fixed;
            width: 8px;
            height: 8px;
            z-index: 9999;
            pointer-events: none;
        }

        body.no-scroll {
            overflow: hidden;
        }

        /* FOCUS GOAL */
        .focus-goal {
            margin: 0 20px 20px;
            background: linear-gradient(135deg, var(--primary), var(--primary-dark));
            color: white;
            padding: 24px;
            border-radius: 24px;
            cursor: pointer;
            box-shadow: 0 8px 24px rgba(255, 153, 102, 0.3);
        }

        .focus-label {
            font-size: 11px;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 1px;
            opacity: 0.9;
            margin-bottom: 8px;
        }

        .focus-title {
            font-size: 22px;
            font-weight: 700;
            margin-bottom: 6px;
        }

        .focus-meta {
            display: flex;
            gap: 12px;
            font-size: 13px;
            opacity: 0.9;
            margin-bottom: 16px;
        }

        .focus-progress-bar {
            height: 6px;
            background: rgba(255, 255, 255, 0.3);
            border-radius: 3px;
            overflow: hidden;
            margin-bottom: 8px;
        }

        .focus-progress-fill {
            height: 100%;
            background: white;
            border-radius: 3px;
        }

        .focus-progress-text {
            font-size: 15px;
            font-weight: 700;
        }

        .no-focus {
            margin: 0 20px 20px;
            padding: 40px 24px;
            background: rgba(255, 255, 255, 0.5);
            backdrop-filter: blur(10px);
            border-radius: 24px;
            text-align: center;
            border: 2px dashed rgba(149, 157, 165, 0.2);
        }

        .no-focus-text {
            font-size: 14px;
            color: var(--text-secondary);
        }

        /* BIG 5 FILTER */
        .big5-filter {
            display: flex;
            gap: 8px;
            overflow-x: auto;
            padding: 4px 0;
        }

        .big5-filter::-webkit-scrollbar {
            display: none;
        }

        .filter-chip {
            padding: 8px 16px;
            background: rgba(255, 255, 255, 0.6);
            backdrop-filter: blur(10px);
            border-radius: 16px;
            border: 1px solid rgba(255, 255, 255, 0.5);
            font-size: 13px;
            font-weight: 600;
            color: var(--text-secondary);
            cursor: pointer;
            white-space: nowrap;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .filter-chip.active {
            background: linear-gradient(135deg, var(--primary), var(--primary-dark));
            color: white;
        }

        /* GOALS SECTIONS */
        .goals-section {
            padding: 20px;
        }

        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 16px;
        }

        .section-title-small {
            font-size: 18px;
            font-weight: 700;
        }

        .add-btn {
            width: 32px;
            height: 32px;
            background: var(--primary);
            color: white;
            border: none;
            border-radius: 16px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
        }

        .goal-card {
            margin-bottom: 12px;
            cursor: pointer;
        }

        .goal-header {
            display: flex;
            justify-content: space-between;
            margin-bottom: 8px;
        }

        .goal-title-row {
            flex: 1;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .goal-icon-small {
            width: 28px;
            height: 28px;
            background: linear-gradient(135deg, var(--primary), var(--primary-dark));
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 14px;
        }

        .goal-title {
            font-size: 16px;
            font-weight: 600;
        }

        .goal-actions {
            display: flex;
            gap: 8px;
        }

        .goal-action-icon {
            color: var(--text-tertiary);
            cursor: pointer;
        }

        .goal-action-icon.focus {
            color: var(--primary);
        }

        .goal-description {
            font-size: 14px;
            color: var(--text-secondary);
            margin-bottom: 8px;
            padding-left: 36px;
        }

        .goal-meta-row {
            display: flex;
            gap: 12px;
            font-size: 12px;
            color: var(--text-secondary);
            margin-bottom: 8px;
            padding-left: 36px;
        }

        .goal-tags {
            display: flex;
            gap: 6px;
            flex-wrap: wrap;
        }

        .goal-tag {
            padding: 3px 8px;
            background: rgba(149, 157, 165, 0.1);
            border-radius: 8px;
            font-size: 11px;
            font-weight: 600;
        }

        .goal-progress-row {
            display: flex;
            align-items: center;
            gap: 12px;
            padding-left: 36px;
        }

        .goal-progress-bar {
            flex: 1;
            height: 6px;
            background: rgba(149, 157, 165, 0.15);
            border-radius: 3px;
            overflow: hidden;
        }

        .goal-progress-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--primary-dark), var(--primary));
            border-radius: 3px;
        }

        .goal-progress-text {
            font-size: 13px;
            font-weight: 600;
            color: var(--text-secondary);
            min-width: 40px;
            text-align: right;
        }

        .empty-state {
            text-align: center;
            padding: 40px 20px;
            color: var(--text-tertiary);
            font-size: 14px;
        }

        /* FORM ELEMENTS */
        textarea.form-input {
            resize: vertical;
            font-family: inherit;
            min-height: 80px;
        }

        .checkbox-group {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .checkbox-item {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 10px;
            background: rgba(149, 157, 165, 0.05);
            border-radius: 10px;
        }

        .checkbox-item input[type="checkbox"] {
            width: 20px;
            height: 20px;
            cursor: pointer;
        }

        .checkbox-item label {
            flex: 1;
            cursor: pointer;
            font-size: 14px;
        }

        .btn-danger {
            background: #FF3B30;
            color: white;
        }

        /* TIMELINE */
        .timeline-section {
            padding-top: 24px;
            border-top: 8px solid transparent;
        }

        .timeline-controls {
            display: flex;
            gap: 8px;
            margin-top: 12px;
            margin-bottom: 16px;
        }

        .timeline-view-btn {
            flex: 1;
            padding: 10px 16px;
            background: rgba(149, 157, 165, 0.1);
            border: 2px solid transparent;
            border-radius: 10px;
            font-size: 14px;
            font-weight: 600;
            color: var(--text-secondary);
            cursor: pointer;
            transition: all 0.2s;
        }

        .timeline-view-btn:hover {
            background: rgba(149, 157, 165, 0.15);
        }

        .timeline-view-btn.active {
            background: rgba(255, 153, 102, 0.15);
            border-color: var(--primary);
            color: var(--primary);
        }

        .timeline-wrapper {
            overflow-x: auto;
            padding: 20px;
            -webkit-overflow-scrolling: touch;
        }

        .timeline-wrapper canvas {
            min-width: 600px;
            display: block;
        }

        .timeline-legend {
            display: flex;
            flex-wrap: wrap;
            gap: 12px;
            padding: 0 20px 16px;
            justify-content: center;
        }

        .legend-item {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 13px;
        }

        .legend-color {
            width: 24px;
            height: 3px;
            border-radius: 2px;
        }

        .legend-label {
            color: var(--text-secondary);
            font-weight: 500;
        }

        .wheel-save-btn {
            width: 100%;
            background: linear-gradient(135deg, var(--primary), var(--primary-dark));
            color: white;
            border: none;
            padding: 16px;
            border-radius: 16px;
            font-size: 17px;
            font-weight: 600;
            cursor: pointer;
            box-shadow: 0 4px 12px rgba(255, 153, 102, 0.3);
        }

        .wheel-save-btn:active {
            transform: scale(0.98);
        }

        /* RING CARDS GRID (Apple Health Style) */
        .ring-cards-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 16px;
            padding: 20px;
        }

        .ring-card {
            background: var(--glass-bg);
            backdrop-filter: blur(20px);
            border: 1px solid var(--glass-border);
            border-radius: 20px;
            padding: 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 12px;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: var(--shadow);
        }

        .ring-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 12px 48px rgba(0, 0, 0, 0.15);
        }

        .ring-card:active {
            transform: translateY(-2px);
        }

        .ring-svg {
            width: 120px;
            height: 120px;
        }

        .ring-value {
            font-size: 36px;
            font-weight: 700;
            color: var(--text-primary);
            line-height: 1;
        }

        .ring-label {
            font-size: 13px;
            color: var(--text-secondary);
            text-align: center;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .ring-trend-badge {
            display: flex;
            align-items: center;
            gap: 6px;
            padding: 6px 12px;
            border-radius: 12px;
            font-size: 13px;
            font-weight: 600;
            margin-top: 4px;
        }

        .trend-up {
            background: rgba(16, 185, 129, 0.15);
            color: #10B981;
        }

        .trend-stable {
            background: rgba(245, 158, 11, 0.15);
            color: #F59E0B;
        }

        .trend-down {
            background: rgba(239, 68, 68, 0.15);
            color: #EF4444;
        }

        .ring-percentage {
            font-size: 11px;
            color: var(--text-tertiary);
            margin-top: 4px;
        }

        /* RING DETAIL MODAL */
        .ring-detail-content {
            max-width: 400px;
        }

        .ring-detail-header {
            text-align: center;
            padding-bottom: 20px;
            border-bottom: 1px solid rgba(149, 157, 165, 0.1);
        }

        .ring-detail-svg {
            width: 160px;
            height: 160px;
            margin: 0 auto 16px;
        }

        .ring-detail-stats {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 12px;
            margin: 20px 0;
        }

        .ring-stat {
            text-align: center;
            padding: 12px;
            background: rgba(149, 157, 165, 0.05);
            border-radius: 10px;
        }

        .ring-stat-value {
            font-size: 20px;
            font-weight: 700;
            color: var(--text-primary);
        }

        .ring-stat-label {
            font-size: 12px;
            color: var(--text-secondary);
            margin-top: 4px;
        }

        .ring-history {
            margin-top: 20px;
        }

        .ring-history-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px 0;
            font-size: 14px;
        }

        .ring-history-date {
            color: var(--text-secondary);
        }

        .ring-history-value {
            font-weight: 600;
            color: var(--text-primary);
        }

        /* COMPLETED RING CELEBRATION */
        .ring-completed {
            position: relative;
        }

        .ring-completed::before {
            content: '';
            position: absolute;
            top: -4px;
            left: -4px;
            right: -4px;
            bottom: -4px;
            border-radius: 50%;
            background: linear-gradient(45deg, #FFD700, #FFA500, #FFD700);
            opacity: 0.3;
            animation: ringPulse 2s ease-in-out infinite;
        }

        @keyframes ringPulse {
            0%, 100% {
                transform: scale(1);
                opacity: 0.3;
            }
            50% {
                transform: scale(1.1);
                opacity: 0.5;
            }
        }

        .ring-completed-badge {
            position: absolute;
            top: -8px;
            right: -8px;
            width: 32px;
            height: 32px;
            background: linear-gradient(135deg, #FFD700, #FFA500);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 18px;
            box-shadow: 0 4px 12px rgba(255, 215, 0, 0.4);
            animation: badgeBounce 0.6s ease-out;
            z-index: 10;
        }

        @keyframes badgeBounce {
            0% {
                transform: scale(0) rotate(0deg);
            }
            50% {
                transform: scale(1.2) rotate(180deg);
            }
            100% {
                transform: scale(1) rotate(360deg);
            }
        }

        .life-card.completed {
            background: linear-gradient(135deg, 
                rgba(255, 215, 0, 0.05), 
                var(--glass-bg) 30%);
            border-color: rgba(255, 215, 0, 0.3);
        }

        .life-card.completed .life-card-main {
            position: relative;
        }

        .completion-sparkles {
            position: fixed;
            pointer-events: none;
            z-index: 10000;
        }

        .sparkle {
            position: absolute;
            font-size: 24px;
            animation: sparkleFloat 1.5s ease-out forwards;
        }

        @keyframes sparkleFloat {
            0% {
                transform: translate(0, 0) scale(0) rotate(0deg);
                opacity: 1;
            }
            100% {
                transform: translate(var(--tx), var(--ty)) scale(1) rotate(360deg);
                opacity: 0;
            }
        }

        /* RESPONSIVE */
        @media (min-width: 768px) {
            .ring-cards-grid {
                grid-template-columns: repeat(3, 1fr);
            }
        }

        @media (min-width: 1024px) {
            .ring-cards-grid {
                grid-template-columns: repeat(4, 1fr);
                padding: 32px;
            }
        }

        /* RADAR CHART SECTION */
        .radar-section {
            padding: 20px;
            margin-bottom: 16px;
        }

        .radar-container {
            position: relative;
            width: 100%;
            max-width: 240px;
            margin: 0 auto;
            aspect-ratio: 1;
            background: var(--glass-bg);
            backdrop-filter: blur(20px);
            border: 1px solid var(--glass-border);
            border-radius: 20px;
            padding: 10px;
            box-shadow: var(--shadow);
        }

        #radarCanvas {
            width: 100%;
            height: 100%;
            display: block;
        }

        /* TOAST NOTIFICATIONS */
        .toast {
            position: fixed;
            bottom: 100px;
            left: 50%;
            transform: translateX(-50%) translateY(100px);
            background: white;
            padding: 16px 24px;
            border-radius: 12px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.2);
            z-index: 100000;
            opacity: 0;
            transition: all 0.3s ease;
            font-size: 15px;
            font-weight: 600;
            max-width: 90%;
        }

        .toast.show {
            opacity: 1;
            transform: translateX(-50%) translateY(0);
        }

        .toast-success {
            border-left: 4px solid #10B981;
        }

        .toast-error {
            border-left: 4px solid #FF3B30;
        }

        /* SETTINGS BUTTON */
        .settings-btn {
            width: 44px;
            height: 44px;
            background: rgba(255, 255, 255, 0.6);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.5);
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            color: var(--text-secondary);
            transition: all 0.2s;
        }

        .settings-btn:hover {
            background: rgba(255, 255, 255, 0.8);
            color: var(--primary);
            transform: scale(1.05);
        }

        /* SETTINGS MODAL */
        .settings-section {
            margin-bottom: 24px;
        }

        .settings-section:last-child {
            margin-bottom: 0;
        }

        .settings-section-title {
            font-size: 15px;
            font-weight: 700;
            margin-bottom: 12px;
            color: var(--text-primary);
        }

        .settings-item {
            margin-bottom: 12px;
        }

        .settings-item:last-child {
            margin-bottom: 0;
        }

        .settings-label {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px;
            background: rgba(149, 157, 165, 0.05);
            border-radius: 10px;
            cursor: pointer;
            font-size: 15px;
        }

        .settings-label input[type="checkbox"] {
            width: 20px;
            height: 20px;
            cursor: pointer;
        }

        .btn i {
            width: 18px;
            height: 18px;
            margin-right: 8px;
        }

        /* DARK MODE */
        body.dark-mode {
            --gradient-bg: linear-gradient(135deg, #1a1a2e 0%, #16213e 25%, #0f3460 50%, #1a1a2e 100%);
            --text-primary: #f0f0f0;
            --text-secondary: #c0c0c0;
            --text-tertiary: #909090;
            --glass-bg: rgba(30, 30, 45, 0.8);
            --glass-border: rgba(255, 255, 255, 0.15);
            --shadow: 0 8px 32px rgba(0, 0, 0, 0.5);
        }

        body.dark-mode .header-title,
        body.dark-mode .header-subtitle,
        body.dark-mode .big5-name,
        body.dark-mode .section-title,
        body.dark-mode .section-title-small,
        body.dark-mode .goal-title,
        body.dark-mode .focus-title,
        body.dark-mode .life-title,
        body.dark-mode .modal-title {
            color: var(--text-primary);
        }

        body.dark-mode .big5-level,
        body.dark-mode .big5-next,
        body.dark-mode .goal-description,
        body.dark-mode .focus-description {
            color: var(--text-secondary);
        }

        body.dark-mode .form-input,
        body.dark-mode .life-target-input,
        body.dark-mode .activity-input {
            background: rgba(255, 255, 255, 0.08);
            color: var(--text-primary);
            border-color: rgba(255, 255, 255, 0.15);
        }

        body.dark-mode .form-input::placeholder {
            color: rgba(192, 192, 192, 0.5);
        }

        body.dark-mode .modal-content {
            background: #1a1a2e;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        body.dark-mode .settings-btn {
            background: rgba(30, 30, 45, 0.8);
            border-color: rgba(255, 255, 255, 0.15);
            color: var(--text-secondary);
        }

        body.dark-mode .settings-btn:hover {
            background: rgba(40, 40, 60, 0.9);
            color: var(--primary);
        }

        body.dark-mode .toast {
            background: #1a1a2e;
            color: var(--text-primary);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        body.dark-mode .glass-card {
            background: rgba(30, 30, 45, 0.7);
            border-color: rgba(255, 255, 255, 0.1);
        }

        body.dark-mode .btn-secondary {
            background: rgba(255, 255, 255, 0.1);
            color: var(--text-primary);
        }

        body.dark-mode .btn-secondary:hover {
            background: rgba(255, 255, 255, 0.15);
        }

        body.dark-mode .settings-label {
            background: rgba(255, 255, 255, 0.05);
            color: var(--text-primary);
        }

        body.dark-mode .settings-section-title {
            color: var(--text-primary);
        }

        body.dark-mode .activity-text {
            color: var(--text-primary);
        }

        body.dark-mode .activity-item-saved {
            background: rgba(255, 255, 255, 0.05);
        }

        body.dark-mode .form-label {
            color: var(--text-primary);
        }

        body.dark-mode .life-value,
        body.dark-mode .life-target {
            color: var(--text-primary);
        }

        body.dark-mode .bottom-nav {
            background: rgba(26, 26, 46, 0.95);
            border-top-color: rgba(255, 255, 255, 0.1);
        }

        body.dark-mode .nav-item {
            color: var(--text-secondary);
        }

        body.dark-mode .nav-item.active {
            color: var(--primary);
        }

        /* RESPONSIVE BREAKPOINTS */
        @media (max-width: 480px) {
            .header-title { font-size: 28px; }
            .header-subtitle { font-size: 15px; }
            .big5-name { font-size: 15px; }
            .big5-icon { width: 40px; height: 40px; }
            .level-up-btn { padding: 6px 12px; font-size: 12px; }
            .focus-title { font-size: 19px; }
            .focus-goal { padding: 20px; }
            .goal-title { font-size: 15px; }
            .section-title-small { font-size: 16px; }
            .modal-content { margin: 0 10px; }
            .wheel-canvas-wrapper { max-width: 100%; }
            .timeline-wrapper canvas { min-width: 500px; }
        }

        @media (min-width: 481px) and (max-width: 768px) {
            .header-title { font-size: 30px; }
            .big5-grid { grid-template-columns: 1fr; }
            .life-grid { grid-template-columns: 1fr; }
        }

        @media (min-width: 769px) and (max-width: 1024px) {
            .big5-grid { grid-template-columns: repeat(2, 1fr); }
            .life-grid { grid-template-columns: 1fr; }
            .header { padding: 40px 32px 24px; }
        }

        @media (min-width: 1025px) {
            body { max-width: 1200px; margin: 0 auto; }
            .big5-grid { grid-template-columns: repeat(2, 1fr); padding: 0 32px 32px; }
            .life-grid { grid-template-columns: 1fr; padding: 0 32px 32px; }
            .header { padding: 60px 32px 32px; }
            .goals-section { padding: 32px; }
            .focus-goal { margin: 0 32px 32px; }
            .bottom-nav { max-width: 1200px; margin: 0 auto; }
        }
    </style>
</head>
<body>
    <!-- DASHBOARD TAB -->
    <div class="tab-content active" id="dashboard">
        <div class="header">
            <div style="display: flex; justify-content: space-between; align-items: flex-start;">
                <div>
                    <div class="header-title">Dashboard</div>
                    <div class="header-subtitle">Deine Big 5 for Life</div>
                </div>
                <button class="settings-btn" onclick="openSettings()" title="Einstellungen">
                    <i data-lucide="settings"></i>
                </button>
            </div>
        </div>

        <div class="big5-grid" id="big5Grid"></div>
    </div>

    <!-- GOALS TAB -->
    <div class="tab-content" id="goals">
        <div class="header">
            <div class="header-title">Deine Ziele</div>
            <div class="header-subtitle">Big 5 for Life</div>
        </div>

        <!-- Focus Goal -->
        <div id="focusGoalContainer"></div>

        <!-- Big 5 Filter -->
        <div style="padding: 0 20px 12px;">
            <div class="big5-filter" id="big5Filter"></div>
        </div>

        <!-- Goals List -->
        <div id="goalsList"></div>
    </div>

    <!-- LIFE WHEEL TAB -->
    <div class="tab-content" id="lifewheel">
        <div class="header">
            <div class="header-title">Life Wheel</div>
            <div class="header-subtitle">Deine Lebensbereiche</div>
        </div>

        <!-- RADAR CHART VISUALIZATION -->
        <div class="radar-section">
            <div class="radar-container">
                <canvas id="radarCanvas" width="240" height="240"></canvas>
            </div>
        </div>

        <div class="life-grid" id="lifeGrid"></div>

        <div style="padding: 20px;">
            <button class="wheel-save-btn" onclick="saveLifeWheelSnapshot()">Aktuellen Stand speichern</button>
        </div>
    </div>

    <!-- BOTTOM NAVIGATION -->
    <div class="bottom-nav">
        <button class="nav-item active" data-tab="dashboard">
            <i data-lucide="layout-dashboard"></i>
            <div>Dashboard</div>
        </button>
        <button class="nav-item" data-tab="goals">
            <i data-lucide="target"></i>
            <div>Ziele</div>
        </button>
        <button class="nav-item" data-tab="lifewheel">
            <i data-lucide="activity"></i>
            <div>Life Wheel</div>
        </button>
    </div>

    <!-- LEVEL UP MODAL -->
    <div class="modal" id="levelModal">
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-title">Level Up!</div>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label class="form-label">Was hast du erreicht?</label>
                    <input type="text" class="form-input" id="levelDescription" placeholder="z.B. Erstes Buch verÃ¶ffentlicht">
                </div>
            </div>
            <div class="modal-actions">
                <button class="btn btn-secondary" onclick="closeLevelModal()">Abbrechen</button>
                <button class="btn btn-primary" onclick="confirmLevelUp()">Level Up! ðŸŽ‰</button>
            </div>
        </div>
    </div>

    <!-- ICON PICKER MODAL -->
    <div class="modal" id="iconModal">
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-title">Icon wÃ¤hlen</div>
            </div>
            <div class="modal-body">
                <div class="icon-grid" id="iconGrid"></div>
            </div>
            <div class="modal-actions">
                <button class="btn btn-secondary" onclick="closeIconModal()">Abbrechen</button>
            </div>
        </div>
    </div>

    <!-- GOAL MODAL -->
    <div class="modal" id="goalModal">
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-title" id="goalModalTitle">Neues Ziel</div>
            </div>
            <form id="goalForm" onsubmit="saveGoal(event)">
                <div class="modal-body">
                    <div class="form-group">
                        <label class="form-label">Icon</label>
                        <div style="display: flex; align-items: center; gap: 12px;">
                            <div class="goal-icon-small" id="selectedGoalIcon" onclick="openIconPickerForGoal()">
                                <i data-lucide="star"></i>
                            </div>
                            <button type="button" class="btn btn-secondary" onclick="openIconPickerForGoal()" style="flex: 1;">Icon Ã¤ndern</button>
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Titel</label>
                        <input type="text" class="form-input" id="goalTitle" placeholder="z.B. Erstes Buch schreiben" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Beschreibung (optional)</label>
                        <textarea class="form-input" id="goalDescription" placeholder="Details zu deinem Ziel..." rows="3"></textarea>
                    </div>
                    <div class="form-group" id="big5SelectGroup">
                        <label class="form-label">Bereich (Big 5)</label>
                        <select class="form-input" id="goalBig5Single">
                            <option value="">WÃ¤hlen...</option>
                        </select>
                    </div>
                    <div class="form-group" id="big5MultiGroup" style="display: none;">
                        <label class="form-label">Bereiche (mehrere mÃ¶glich)</label>
                        <div id="big5Checkboxes"></div>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Deadline</label>
                        <input type="date" class="form-input" id="goalEndDate" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Fortschritt: <span id="goalProgressValue">0</span>%</label>
                        <input type="range" class="life-slider" id="goalProgress" min="0" max="100" value="0" oninput="updateGoalProgressValue(this.value)">
                    </div>
                </div>
                <div class="modal-actions">
                    <button type="button" class="btn btn-secondary" onclick="closeGoalModal()">Abbrechen</button>
                    <button type="button" class="btn btn-danger" id="goalDeleteBtn" onclick="deleteGoal()" style="display: none;">LÃ¶schen</button>
                    <button type="submit" class="btn btn-primary">Speichern</button>
                </div>
            </form>
        </div>
    </div>

    <!-- RING DETAIL MODAL -->
    <div class="modal" id="ringDetailModal">
        <div class="modal-content ring-detail-content">
            <div class="modal-header">
                <div class="modal-title" id="ringDetailTitle">Gesundheit</div>
            </div>
            <div class="modal-body">
                <div class="ring-detail-header">
                    <svg class="ring-detail-svg" id="ringDetailSvg" viewBox="0 0 160 160"></svg>
                    <div class="ring-value" id="ringDetailValue">8</div>
                    <div class="ring-percentage" id="ringDetailPercentage">80% vom Ziel</div>
                </div>
                
                <div class="ring-detail-stats">
                    <div class="ring-stat">
                        <div class="ring-stat-value" id="ringStatCurrent">8</div>
                        <div class="ring-stat-label">Aktuell</div>
                    </div>
                    <div class="ring-stat">
                        <div class="ring-stat-value" id="ringStatTarget">10</div>
                        <div class="ring-stat-label">Ziel</div>
                    </div>
                    <div class="ring-stat">
                        <div class="ring-stat-value" id="ringStatTrend">+1</div>
                        <div class="ring-stat-label">Ã„nderung</div>
                    </div>
                    <div class="ring-stat">
                        <div class="ring-stat-value" id="ringStatAvg">7.5</div>
                        <div class="ring-stat-label">7-Tage Ã˜</div>
                    </div>
                </div>
                
                <div class="ring-history" id="ringHistory">
                    <div style="font-size: 13px; font-weight: 600; margin-bottom: 12px; color: var(--text-secondary);">Verlauf (letzte 4 Wochen)</div>
                </div>
            </div>
            <div class="modal-actions">
                <button class="btn btn-primary" onclick="closeRingDetail()" style="width: 100%;">SchlieÃŸen</button>
            </div>
        </div>
    </div>

    <!-- SETTINGS MODAL -->
    <div class="modal" id="settingsModal">
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-title">Einstellungen</div>
            </div>
            <div class="modal-body">
                <div class="settings-section">
                    <div class="settings-section-title">ðŸŒ™ Design</div>
                    <div class="settings-item">
                        <label class="settings-label">
                            <input type="checkbox" id="darkModeToggle" onchange="toggleDarkMode()">
                            <span>Dark Mode</span>
                        </label>
                    </div>
                </div>

                <div class="settings-section">
                    <div class="settings-section-title">ðŸ’¾ Daten</div>
                    <div class="settings-item">
                        <button class="btn btn-secondary" onclick="exportData()" style="width: 100%;">
                            <i data-lucide="download"></i>
                            <span>Daten exportieren</span>
                        </button>
                    </div>
                    <div class="settings-item">
                        <label class="btn btn-secondary" style="width: 100%; cursor: pointer; margin: 0;">
                            <i data-lucide="upload"></i>
                            <span>Daten importieren</span>
                            <input type="file" id="importFile" accept=".json" onchange="importData(event)" style="display: none;">
                        </label>
                    </div>
                    <div class="settings-item">
                        <button class="btn btn-danger" onclick="confirmReset()" style="width: 100%;">
                            <i data-lucide="trash-2"></i>
                            <span>Alle Daten lÃ¶schen</span>
                        </button>
                    </div>
                </div>

                <div class="settings-section">
                    <div class="settings-section-title">â„¹ï¸ Info</div>
                    <div style="font-size: 13px; color: var(--text-secondary); line-height: 1.6;">
                        <strong>42life Premium</strong><br>
                        Version 2.0<br>
                        Erstellt mit â¤ï¸ fÃ¼r deine persÃ¶nliche Entwicklung
                    </div>
                </div>
            </div>
            <div class="modal-actions">
                <button class="btn btn-primary" onclick="closeSettings()" style="width: 100%;">SchlieÃŸen</button>
            </div>
        </div>
    </div>

    <script>
        // ==================== UTILITIES ====================
        function escapeHtml(unsafe) {
            if (typeof unsafe !== 'string') return unsafe;
            return unsafe
                .replace(/&/g, "&amp;")
                .replace(/</g, "&lt;")
                .replace(/>/g, "&gt;")
                .replace(/"/g, "&quot;")
                .replace(/'/g, "&#039;");
        }

        function showToast(message, type = 'success') {
            const toast = document.createElement('div');
            toast.className = `toast toast-${type}`;
            toast.textContent = message;
            document.body.appendChild(toast);
            
            setTimeout(() => toast.classList.add('show'), 10);
            setTimeout(() => {
                toast.classList.remove('show');
                setTimeout(() => toast.remove(), 300);
            }, 3000);
        }

        // ==================== STATE ====================
        const State = {
            big5: {
                entrepreneur: { 
                    name: 'Entrepreneurship', 
                    icon: 'rocket',
                    level: 1, 
                    levelDescription: '',
                    nextMilestone: 'Erstes Produkt launchen'
                },
                books: { 
                    name: 'Book Author', 
                    icon: 'book-open',
                    level: 1, 
                    levelDescription: '',
                    nextMilestone: 'Erstes Buch schreiben'
                },
                food: { 
                    name: 'Food Ambassador', 
                    icon: 'salad',
                    level: 1, 
                    levelDescription: '',
                    nextMilestone: 'Ersten Workshop halten'
                },
                family: { 
                    name: 'Happy Family', 
                    icon: 'heart',
                    level: 1, 
                    levelDescription: '',
                    nextMilestone: 'Quality Time etablieren'
                },
                world: { 
                    name: 'World Explorer', 
                    icon: 'globe',
                    level: 1, 
                    levelDescription: '',
                    nextMilestone: '10 LÃ¤nder bereisen'
                }
            },
            goals: {
                'five-year': [],
                'yearly': [],
                'quarterly': []
            },
            focusGoalId: null,
            selectedBig5Filter: 'all',
            lifeWheel: {
                health: { name: 'Gesundheit', icon: 'heart-pulse', current: 7, target: 10, color: '#10B981', activities: [], completed: false },
                love: { name: 'Liebe', icon: 'heart', current: 8, target: 10, color: '#EF4444', activities: [], completed: false },
                social: { name: 'Soziales', icon: 'users', current: 6, target: 10, color: '#8B5CF6', activities: [], completed: false },
                career: { name: 'Karriere', icon: 'briefcase', current: 7, target: 10, color: '#3B82F6', activities: [], completed: false },
                growth: { name: 'Entwicklung', icon: 'trending-up', current: 5, target: 10, color: '#14B8A6', activities: [], completed: false },
                fun: { name: 'SpaÃŸ', icon: 'smile', current: 6, target: 10, color: '#F59E0B', activities: [], completed: false },
                finance: { name: 'Finanzen', icon: 'dollar-sign', current: 6, target: 10, color: '#EAB308', activities: [], completed: false }
            },
            lifeWheelHistory: [],
            expandedLifeCard: null,
            editingActivity: null,
            currentLevelUpKey: null,
            currentIconTarget: null,
            editingGoalId: null,
            editingGoalType: null,
            currentGoalIcon: 'star',
            darkMode: false,
            timelineView: 4
        };

        // Load demo goals
        function loadDemoGoals() {
            const endOf2026 = '2026-12-31';
            
            State.goals = {
                'five-year': [
                    { 
                        id: 1001, 
                        title: 'Signifikantes Nebeneinkommen durch AktivitÃ¤ten', 
                        description: 'Ich erreiche durch meine AktivitÃ¤ten ein signifikantes Nebeneinkommen',
                        tags: ['entrepreneur'], 
                        progress: 70, 
                        endDate: endOf2026, 
                        icon: 'rocket' 
                    },
                    { 
                        id: 1002, 
                        title: 'Als Experte fÃ¼r Lebensmittelsektor wahrgenommen', 
                        description: 'Eine relevante Bubble von Menschen nimmt mich als Experte fÃ¼r den Lebensmittelsektor wahr',
                        tags: ['food'], 
                        progress: 95, 
                        endDate: endOf2026, 
                        icon: 'salad' 
                    },
                    { 
                        id: 1003, 
                        title: 'Erstes Buch verÃ¶ffentlicht und generiert Einnahmen', 
                        description: 'Mein erstes Buch ist (mit einem Verlag) verÃ¶ffentlicht und generiert Einnahmen',
                        tags: ['books'], 
                        progress: 60, 
                        endDate: endOf2026, 
                        icon: 'book-open' 
                    },
                    { 
                        id: 1004, 
                        title: 'Happy Family - Zeit, Sicherheit, Gesundheit', 
                        description: 'Wir haben ausreichende Zeit fÃ¼reinander, sind finanziell sicher aufgestellt, machen Urlaube, treffen Freunde und sind gesund',
                        tags: ['family'], 
                        progress: 60, 
                        endDate: endOf2026, 
                        icon: 'heart' 
                    },
                    { 
                        id: 1005, 
                        title: 'Japan erkundet - jÃ¤hrliche Urlaube', 
                        description: 'Wir machen jÃ¤hrlich Urlaub und haben Japan erkundet',
                        tags: ['world'], 
                        progress: 100, 
                        endDate: endOf2026, 
                        icon: 'globe' 
                    }
                ],
                'yearly': [],
                'quarterly': []
            };
            
            State.focusGoalId = null;
        }

        // Lucide Icons Array
        const lucideIcons = [
            'rocket', 'book-open', 'briefcase', 'heart', 'globe', 'star', 'zap', 'target',
            'award', 'trending-up', 'lightbulb', 'coffee', 'music', 'camera', 'palette',
            'pen-tool', 'code', 'cpu', 'database', 'server', 'smartphone', 'tablet',
            'wifi', 'bluetooth', 'battery', 'bell', 'calendar', 'clock', 'compass',
            'map', 'navigation', 'anchor', 'plane', 'train', 'bike', 'car',
            'home', 'building', 'store', 'shopping-cart', 'gift', 'package',
            'dollar-sign', 'euro', 'credit-card', 'pie-chart', 'bar-chart', 'line-chart',
            'users', 'user', 'smile', 'laugh', 'frown', 'message-circle', 'mail',
            'phone', 'video', 'mic', 'headphones', 'speaker', 'volume-2',
            'sun', 'moon', 'cloud', 'umbrella', 'wind', 'droplet', 'flame',
            'leaf', 'flower', 'tree', 'sprout', 'apple', 'salad', 'cookie',
            'pizza', 'utensils', 'wine', 'beer', 'dumbbell', 'activity', 'heart-pulse'
        ];

        // ==================== RENDERING ====================
        function renderBig5Grid() {
            const container = document.getElementById('big5Grid');
            let html = '';
            
            Object.entries(State.big5).forEach(([key, data]) => {
                // Progress to next level (example: 33%)
                const progress = 33; // This could be calculated based on goals later
                
                html += `
                    <div class="glass-card big5-card">
                        <div class="big5-header">
                            <div class="big5-icon" onclick="event.stopPropagation(); openIconPickerForBig5('${key}')">
                                <i data-lucide="${data.icon}"></i>
                            </div>
                            <div class="big5-info" onclick="openBig5Detail('${key}')">
                                <div class="big5-name">${data.name}</div>
                                <div class="big5-level">Level ${data.level}</div>
                            </div>
                            <button class="level-up-btn" onclick="event.stopPropagation(); openLevelUp('${key}')">
                                Level Up
                            </button>
                        </div>
                        <div class="big5-progress" onclick="openBig5Detail('${key}')">
                            <div class="progress-label">NÃ¤chster Meilenstein: ${data.nextMilestone}</div>
                            <div class="progress-bar">
                                <div class="progress-fill" style="width: ${progress}%;"></div>
                            </div>
                        </div>
                    </div>
                `;
            });
            
            container.innerHTML = html;
            lucide.createIcons();
        }

        // ==================== RAINBOW WHEEL ====================
        function renderRadarChart() {
            const canvas = document.getElementById('rainbowWheelCanvas');
            if (!canvas) return;
            
            const ctx = canvas.getContext('2d');
            const size = canvas.width;
            const centerX = size / 2;
            const centerY = size / 2;
            
            ctx.clearRect(0, 0, size, size);
            
            const areas = [
                { key: 'health', emoji: 'ðŸ’š', angle: 0 },
                { key: 'love', emoji: 'â¤ï¸', angle: 51.43 },
                { key: 'social', emoji: 'ðŸ‘¥', angle: 102.86 },
                { key: 'career', emoji: 'ðŸ’¼', angle: 154.29 },
                { key: 'growth', emoji: 'ðŸ“ˆ', angle: 205.71 },
                { key: 'fun', emoji: 'ðŸ˜Š', angle: 257.14 },
                { key: 'finance', emoji: 'ðŸ’°', angle: 308.57 }
            ];
            
            const numRings = 10;
            const maxRadius = 180;
            const ringThickness = 15;
            const gap = 2;
            
            areas.forEach((area) => {
                const data = State.lifeWheel[area.key];
                if (!data) return;
                
                const progress = data.current / data.target;
                const filledRings = Math.floor(progress * numRings);
                
                const angleStart = (area.angle - 25.71) * (Math.PI / 180);
                const angleEnd = (area.angle + 25.71) * (Math.PI / 180);
                
                for (let ring = 0; ring < numRings; ring++) {
                    const innerRadius = maxRadius - (ring + 1) * (ringThickness + gap);
                    const outerRadius = maxRadius - ring * (ringThickness + gap);
                    
                    const isFilled = ring < filledRings;
                    
                    const gradient = ctx.createRadialGradient(
                        centerX, centerY, innerRadius,
                        centerX, centerY, outerRadius
                    );
                    
                    if (isFilled) {
                        gradient.addColorStop(0, data.color);
                        gradient.addColorStop(1, adjustColorBrightness(data.color, -20));
                    } else {
                        gradient.addColorStop(0, 'rgba(149, 157, 165, 0.08)');
                        gradient.addColorStop(1, 'rgba(149, 157, 165, 0.05)');
                    }
                    
                    ctx.beginPath();
                    ctx.arc(centerX, centerY, outerRadius, angleStart, angleEnd);
                    ctx.arc(centerX, centerY, innerRadius, angleEnd, angleStart, true);
                    ctx.closePath();
                    
                    ctx.fillStyle = gradient;
                    ctx.fill();
                }
                
                // White separators
                ctx.strokeStyle = 'rgba(255, 255, 255, 0.8)';
                ctx.lineWidth = 2;
                ctx.beginPath();
                ctx.moveTo(centerX, centerY);
                const endX = centerX + Math.cos(angleStart) * maxRadius;
                const endY = centerY + Math.sin(angleStart) * maxRadius;
                ctx.lineTo(endX, endY);
                ctx.stroke();
            });
            
            renderRainbowIcons(areas, maxRadius + 30);
        }

        function renderRainbowIcons(areas, iconRadius) {
            const container = document.getElementById('rainbowWheelIcons');
            if (!container) return;
            
            const centerX = container.offsetWidth / 2;
            const centerY = container.offsetHeight / 2;
            
            container.innerHTML = '';
            
            areas.forEach(area => {
                const angle = area.angle * (Math.PI / 180);
                const x = centerX + Math.cos(angle) * iconRadius;
                const y = centerY + Math.sin(angle) * iconRadius;
                
                const iconDiv = document.createElement('div');
                iconDiv.className = 'rainbow-icon';
                iconDiv.textContent = area.emoji;
                iconDiv.style.left = x + 'px';
                iconDiv.style.top = y + 'px';
                
                container.appendChild(iconDiv);
            });
        }

        function adjustColorBrightness(color, percent) {
            const num = parseInt(color.replace('#', ''), 16);
            const amt = Math.round(2.55 * percent);
            const R = (num >> 16) + amt;
            const G = (num >> 8 & 0x00FF) + amt;
            const B = (num & 0x0000FF) + amt;
            return '#' + (
                0x1000000 +
                (R < 255 ? R < 1 ? 0 : R : 255) * 0x10000 +
                (G < 255 ? G < 1 ? 0 : G : 255) * 0x100 +
                (B < 255 ? B < 1 ? 0 : B : 255)
            ).toString(16).slice(1);
        }

        function renderLifeWheel() {
            const canvas = document.getElementById('lifeWheelCanvas');
            if (!canvas) return;
            
            const dpr = window.devicePixelRatio || 1;
            const size = 500; // increased from 400
            canvas.width = size * dpr;
            canvas.height = size * dpr;
            
            const ctx = canvas.getContext('2d');
            ctx.scale(dpr, dpr);
            ctx.clearRect(0, 0, size, size);
            
            const centerX = size / 2, centerY = size / 2, maxRadius = 160; // increased from 140
            const areas = Object.keys(State.lifeWheel);
            const angleStep = (Math.PI * 2) / areas.length;
            
            // Grid circles
            ctx.strokeStyle = 'rgba(149, 157, 165, 0.1)';
            ctx.lineWidth = 1;
            for (let i = 1; i <= 10; i++) {
                ctx.beginPath();
                ctx.arc(centerX, centerY, (maxRadius / 10) * i, 0, Math.PI * 2);
                ctx.stroke();
            }
            
            // Grid lines
            areas.forEach((_, index) => {
                const angle = angleStep * index - Math.PI / 2;
                const x = centerX + Math.cos(angle) * maxRadius;
                const y = centerY + Math.sin(angle) * maxRadius;
                ctx.beginPath();
                ctx.moveTo(centerX, centerY);
                ctx.lineTo(x, y);
                ctx.stroke();
            });
            
            // Current values (filled)
            ctx.beginPath();
            areas.forEach((key, index) => {
                const angle = angleStep * index - Math.PI / 2;
                const radius = (maxRadius / 10) * State.lifeWheel[key].current;
                const x = centerX + Math.cos(angle) * radius;
                const y = centerY + Math.sin(angle) * radius;
                if (index === 0) ctx.moveTo(x, y); else ctx.lineTo(x, y);
            });
            ctx.closePath();
            ctx.fillStyle = 'rgba(255, 153, 102, 0.15)';
            ctx.fill();
            ctx.strokeStyle = '#FF9966';
            ctx.lineWidth = 3;
            ctx.stroke();
            
            // Target values (dashed line)
            ctx.beginPath();
            ctx.setLineDash([5, 5]);
            areas.forEach((key, index) => {
                const angle = angleStep * index - Math.PI / 2;
                const radius = (maxRadius / 10) * State.lifeWheel[key].target;
                const x = centerX + Math.cos(angle) * radius;
                const y = centerY + Math.sin(angle) * radius;
                if (index === 0) ctx.moveTo(x, y); else ctx.lineTo(x, y);
            });
            ctx.closePath();
            ctx.strokeStyle = '#B4B4C8';
            ctx.lineWidth = 2;
            ctx.stroke();
            ctx.setLineDash([]);
            
            // Labels with icons rendered directly in canvas
            ctx.textAlign = 'center';
            ctx.textBaseline = 'middle';
            
            // Icon mapping - emoji that match Lucide icons visually
            const iconEmojis = {
                'heart-pulse': 'ðŸ’š',
                'heart': 'â¤ï¸',
                'users': 'ðŸ‘¥',
                'briefcase': 'ðŸ’¼',
                'trending-up': 'ðŸ“ˆ',
                'smile': 'ðŸ˜Š',
                'dollar-sign': 'ðŸ’°'
            };
            
            areas.forEach((key, index) => {
                const angle = angleStep * index - Math.PI / 2;
                const labelRadius = maxRadius + 60;
                const x = centerX + Math.cos(angle) * labelRadius;
                const y = centerY + Math.sin(angle) * labelRadius;
                
                // Icon (emoji)
                ctx.font = '24px -apple-system, sans-serif';
                const icon = iconEmojis[State.lifeWheel[key].icon] || 'â—';
                ctx.fillText(icon, x, y - 4);
                
                // Name
                ctx.font = '13px -apple-system, sans-serif';
                ctx.fillStyle = '#2D3142';
                ctx.fillText(State.lifeWheel[key].name, x, y + 14);
                
                // Value
                ctx.font = 'bold 13px -apple-system, sans-serif';
                ctx.fillStyle = State.lifeWheel[key].color;
                ctx.fillText(`${State.lifeWheel[key].current}/${State.lifeWheel[key].target}`, x, y + 28);
            });
        }

        // ==================== RADAR CHART VISUALIZATION ====================
        function renderRadarChart() {
            const canvas = document.getElementById('radarCanvas');
            if (!canvas) return;
            
            const ctx = canvas.getContext('2d');
            const dpr = window.devicePixelRatio || 1;
            const size = 240;
            
            canvas.width = size * dpr;
            canvas.height = size * dpr;
            ctx.scale(dpr, dpr);
            
            const centerX = size / 2;
            const centerY = size / 2;
            const maxRadius = 85;
            const levels = 5;
            
            ctx.clearRect(0, 0, size, size);
            
            const areas = [
                { key: 'health', color: '#10B981', name: 'Gesundheit' },
                { key: 'love', color: '#EF4444', name: 'Liebe' },
                { key: 'social', color: '#8B5CF6', name: 'Soziales' },
                { key: 'career', color: '#3B82F6', name: 'Karriere' },
                { key: 'growth', color: '#14B8A6', name: 'Entwicklung' },
                { key: 'fun', color: '#F59E0B', name: 'SpaÃŸ' },
                { key: 'finance', color: '#EAB308', name: 'Finanzen' }
            ];
            
            const numAxes = areas.length;
            const angleStep = (Math.PI * 2) / numAxes;
            
            // Draw grid levels (background circles)
            ctx.strokeStyle = 'rgba(149, 157, 165, 0.15)';
            ctx.lineWidth = 1;
            for (let i = 1; i <= levels; i++) {
                const radius = (maxRadius / levels) * i;
                ctx.beginPath();
                for (let j = 0; j <= numAxes; j++) {
                    const angle = j * angleStep - Math.PI / 2;
                    const x = centerX + Math.cos(angle) * radius;
                    const y = centerY + Math.sin(angle) * radius;
                    if (j === 0) {
                        ctx.moveTo(x, y);
                    } else {
                        ctx.lineTo(x, y);
                    }
                }
                ctx.closePath();
                ctx.stroke();
            }
            
            // Draw axes
            ctx.strokeStyle = 'rgba(149, 157, 165, 0.2)';
            ctx.lineWidth = 1;
            areas.forEach((area, i) => {
                const angle = i * angleStep - Math.PI / 2;
                const x = centerX + Math.cos(angle) * maxRadius;
                const y = centerY + Math.sin(angle) * maxRadius;
                
                ctx.beginPath();
                ctx.moveTo(centerX, centerY);
                ctx.lineTo(x, y);
                ctx.stroke();
            });
            
            // Draw target polygon (dashed line)
            ctx.strokeStyle = 'rgba(149, 157, 165, 0.3)';
            ctx.lineWidth = 2;
            ctx.setLineDash([5, 5]);
            ctx.beginPath();
            areas.forEach((area, i) => {
                const data = State.lifeWheel[area.key];
                if (!data) return;
                
                const angle = i * angleStep - Math.PI / 2;
                const targetRadius = (data.target / 10) * maxRadius;
                const x = centerX + Math.cos(angle) * targetRadius;
                const y = centerY + Math.sin(angle) * targetRadius;
                
                if (i === 0) {
                    ctx.moveTo(x, y);
                } else {
                    ctx.lineTo(x, y);
                }
            });
            ctx.closePath();
            ctx.stroke();
            ctx.setLineDash([]);
            
            // Draw current values polygon (filled)
            ctx.beginPath();
            areas.forEach((area, i) => {
                const data = State.lifeWheel[area.key];
                if (!data) return;
                
                const angle = i * angleStep - Math.PI / 2;
                const valueRadius = (data.current / 10) * maxRadius;
                const x = centerX + Math.cos(angle) * valueRadius;
                const y = centerY + Math.sin(angle) * valueRadius;
                
                if (i === 0) {
                    ctx.moveTo(x, y);
                } else {
                    ctx.lineTo(x, y);
                }
            });
            ctx.closePath();
            
            // Fill with gradient
            const gradient = ctx.createRadialGradient(centerX, centerY, 0, centerX, centerY, maxRadius);
            gradient.addColorStop(0, 'rgba(255, 153, 102, 0.2)');
            gradient.addColorStop(1, 'rgba(255, 153, 102, 0.05)');
            ctx.fillStyle = gradient;
            ctx.fill();
            
            // Stroke outline
            ctx.strokeStyle = 'var(--primary)';
            ctx.lineWidth = 2.5;
            ctx.stroke();
            
            // Draw points on polygon
            areas.forEach((area, i) => {
                const data = State.lifeWheel[area.key];
                if (!data) return;
                
                const angle = i * angleStep - Math.PI / 2;
                const valueRadius = (data.current / 10) * maxRadius;
                const x = centerX + Math.cos(angle) * valueRadius;
                const y = centerY + Math.sin(angle) * valueRadius;
                
                // Point
                ctx.beginPath();
                ctx.arc(x, y, 5, 0, Math.PI * 2);
                ctx.fillStyle = area.color;
                ctx.fill();
                ctx.strokeStyle = 'white';
                ctx.lineWidth = 2;
                ctx.stroke();
            });
            
            // Draw labels with better spacing
            ctx.font = '600 9px -apple-system, sans-serif';
            ctx.textBaseline = 'middle';
            
            areas.forEach((area, i) => {
                const data = State.lifeWheel[area.key];
                if (!data) return;
                
                const angle = i * angleStep - Math.PI / 2;
                const labelRadius = maxRadius + 14;
                const x = centerX + Math.cos(angle) * labelRadius;
                const y = centerY + Math.sin(angle) * labelRadius;
                
                // Adjust text alignment based on position
                if (Math.abs(Math.cos(angle)) < 0.3) {
                    ctx.textAlign = 'center';
                } else if (Math.cos(angle) > 0) {
                    ctx.textAlign = 'left';
                } else {
                    ctx.textAlign = 'right';
                }
                
                // Name
                ctx.fillStyle = area.color;
                ctx.fillText(area.name, x, y - 6);
                
                // Value
                ctx.font = 'bold 10px -apple-system, sans-serif';
                ctx.fillStyle = area.color;
                ctx.fillText(`${data.current}/${data.target}`, x, y + 5);
                ctx.font = '600 9px -apple-system, sans-serif';
            });
        }

        function adjustColorBrightness(color, percent) {
            const num = parseInt(color.replace('#', ''), 16);
            const amt = Math.round(2.55 * percent);
            const R = (num >> 16) + amt;
            const G = (num >> 8 & 0x00FF) + amt;
            const B = (num & 0x0000FF) + amt;
            return '#' + (0x1000000 + (R < 255 ? R < 1 ? 0 : R : 255) * 0x10000 +
                (G < 255 ? G < 1 ? 0 : G : 255) * 0x100 +
                (B < 255 ? B < 1 ? 0 : B : 255))
                .toString(16).slice(1);
        }

        function renderLifeGrid() {
            const container = document.getElementById('lifeGrid');
            if (!container) return;
            
            let html = '';
            
            Object.entries(State.lifeWheel).forEach(([key, data]) => {
                const isExpanded = State.expandedLifeCard === key;
                const current = data.current;
                const target = data.target;
                const percentage = Math.round((current / target) * 100);
                const isCompleted = current >= target;
                
                // Calculate trend
                let trend = 'â†’';
                let trendClass = 'trend-stable';
                let trendValue = 'Â±0';
                
                if (State.lifeWheelHistory.length >= 2) {
                    const latest = State.lifeWheelHistory[State.lifeWheelHistory.length - 1];
                    const previous = State.lifeWheelHistory[State.lifeWheelHistory.length - 2];
                    
                    if (latest && previous && latest.values[key] !== undefined && previous.values[key] !== undefined) {
                        const diff = latest.values[key] - previous.values[key];
                        if (diff > 0) {
                            trend = 'â†—ï¸';
                            trendClass = 'trend-up';
                            trendValue = `+${diff}`;
                        } else if (diff < 0) {
                            trend = 'â†˜ï¸';
                            trendClass = 'trend-down';
                            trendValue = `${diff}`;
                        }
                    }
                }
                
                html += `
                    <div class="glass-card life-card ${isExpanded ? 'expanded' : ''} ${isCompleted ? 'completed' : ''}" id="life-card-${key}">
                        <div class="life-card-main" onclick="toggleLifeCard('${key}')">
                            <div class="life-card-ring ${isCompleted ? 'ring-completed' : ''}">
                                ${createRingSVG(current, target, data.color, 80)}
                                ${isCompleted ? '<div class="ring-completed-badge">ðŸ†</div>' : ''}
                            </div>
                            <div class="life-card-info">
                                <div class="life-card-name">
                                    <i data-lucide="${data.icon}" style="width: 18px; height: 18px; color: ${data.color}; margin-right: 6px;"></i>
                                    ${data.name}
                                </div>
                                <div class="life-card-values">${current}<span class="life-card-target-small"> / ${target}</span></div>
                                <div class="ring-trend-badge ${trendClass}">
                                    <span>${trend}</span>
                                    <span>${trendValue}</span>
                                </div>
                            </div>
                            <input 
                                type="number" 
                                class="life-target-input" 
                                min="1" 
                                max="10" 
                                value="${target}" 
                                onchange="updateLifeAreaTarget('${key}', this.value)"
                                onclick="event.stopPropagation()"
                                title="Zielwert"
                            >
                        </div>
                        
                        <div class="life-card-controls">
                            <input 
                                type="range" 
                                class="life-slider" 
                                min="0" 
                                max="${target}" 
                                value="${current}" 
                                oninput="updateLifeAreaCurrent('${key}', this.value)"
                                onclick="event.stopPropagation()"
                                style="flex: 1; accent-color: ${data.color};"
                            >
                            <div class="life-value-badge" id="val-${key}">${current}</div>
                        </div>
                        
                        <div class="life-card-content">
                            <div class="activities-section">
                                <div style="font-size: 13px; font-weight: 600; margin-bottom: 12px;">AktivitÃ¤ten die darauf einzahlen:</div>
                                <div id="activities-${key}">
                                    ${(data.activities || []).map((activity, idx) => `
                                        <div class="activity-item-saved">
                                            <div class="activity-text">${activity || 'Keine Beschreibung'}</div>
                                            <div class="activity-actions">
                                                <i data-lucide="pencil" class="activity-edit-icon" onclick="editActivity('${key}', ${idx})" title="Bearbeiten"></i>
                                                <i data-lucide="trash-2" class="activity-delete-icon" onclick="deleteActivity('${key}', ${idx})" title="LÃ¶schen"></i>
                                            </div>
                                        </div>
                                    `).join('')}
                                    ${State.editingActivity && State.editingActivity.key === key ? `
                                        <div class="activity-item-editing">
                                            <input 
                                                type="text" 
                                                class="activity-input" 
                                                id="activity-edit-input"
                                                value="${State.editingActivity.value}" 
                                                placeholder="z.B. 3x pro Woche Sport"
                                            >
                                            <button class="activity-save-btn" onclick="saveActivity('${key}')">
                                                <i data-lucide="check"></i>
                                            </button>
                                            <button class="activity-cancel-btn" onclick="cancelEditActivity()">
                                                <i data-lucide="x"></i>
                                            </button>
                                        </div>
                                    ` : ''}
                                </div>
                                ${!State.editingActivity || State.editingActivity.key !== key ? `
                                    <button class="add-activity-btn" onclick="addActivity('${key}')">
                                        + AktivitÃ¤t hinzufÃ¼gen
                                    </button>
                                ` : ''}
                            </div>
                        </div>
                    </div>
                `;
            });
            
            container.innerHTML = html;
            lucide.createIcons();
        }
        
        function toggleLifeCard(key) {
            State.expandedLifeCard = State.expandedLifeCard === key ? null : key;
            State.editingActivity = null; // Close editing when toggling
            renderLifeGrid();
        }
        
        function addActivity(key) {
            if (!State.lifeWheel[key].activities) {
                State.lifeWheel[key].activities = [];
            }
            State.editingActivity = {
                key: key,
                index: -1, // -1 means new
                value: ''
            };
            renderLifeGrid();
            
            // Focus the input
            setTimeout(() => {
                const input = document.getElementById('activity-edit-input');
                if (input) input.focus();
            }, 100);
        }
        
        function editActivity(key, index) {
            State.editingActivity = {
                key: key,
                index: index,
                value: State.lifeWheel[key].activities[index]
            };
            renderLifeGrid();
            
            setTimeout(() => {
                const input = document.getElementById('activity-edit-input');
                if (input) input.focus();
            }, 100);
        }
        
        function saveActivity(key) {
            const input = document.getElementById('activity-edit-input');
            if (!input || !input.value.trim()) {
                cancelEditActivity();
                return;
            }
            
            const value = input.value.trim();
            
            if (State.editingActivity.index === -1) {
                // New activity
                State.lifeWheel[key].activities.push(value);
                showToast('âœ… AktivitÃ¤t hinzugefÃ¼gt', 'success');
            } else {
                // Edit existing
                State.lifeWheel[key].activities[State.editingActivity.index] = value;
                showToast('âœ… AktivitÃ¤t aktualisiert', 'success');
            }
            
            State.editingActivity = null;
            saveState();
            renderLifeGrid();
        }
        
        function cancelEditActivity() {
            State.editingActivity = null;
            renderLifeGrid();
        }
        
        function deleteActivity(key, index) {
            if (!confirm('AktivitÃ¤t wirklich lÃ¶schen?')) return;
            
            State.lifeWheel[key].activities.splice(index, 1);
            saveState();
            renderLifeGrid();
            
            showToast('ðŸ—‘ï¸ AktivitÃ¤t gelÃ¶scht', 'error');
        }

        // ==================== INTERACTIONS ====================
        function openBig5Detail(key) {
            // Switch to Goals tab
            State.selectedBig5Filter = key;
            
            // Update navigation
            document.querySelectorAll('.nav-item').forEach(b => b.classList.remove('active'));
            document.querySelector('[data-tab="goals"]').classList.add('active');
            
            // Update tabs
            document.querySelectorAll('.tab-content').forEach(t => t.classList.remove('active'));
            document.getElementById('goals').classList.add('active');
            
            // Render goals
            setTimeout(() => {
                renderFocusGoal();
                renderBig5Filter();
                renderGoalsList();
                lucide.createIcons();
            }, 100);
        }

        function openLevelUp(key) {
            State.currentLevelUpKey = key;
            document.getElementById('levelDescription').value = '';
            document.getElementById('levelModal').classList.add('active');
            document.body.classList.add('no-scroll');
        }

        function closeLevelModal() {
            document.getElementById('levelModal').classList.remove('active');
            document.body.classList.remove('no-scroll');
            State.currentLevelUpKey = null;
        }

        function confirmLevelUp() {
            if (!State.currentLevelUpKey) return;
            
            const description = document.getElementById('levelDescription').value;
            const big5Name = State.big5[State.currentLevelUpKey].name;
            State.big5[State.currentLevelUpKey].level++;
            State.big5[State.currentLevelUpKey].levelDescription = description;
            
            createConfetti();
            closeLevelModal();
            renderBig5Grid();
            saveState();
            
            showToast(`ðŸŽ‰ Level Up! ${big5Name} Level ${State.big5[State.currentLevelUpKey].level}`, 'success');
        }

        // ==================== TIMELINE ====================
        function renderTimeline() {
            const canvas = document.getElementById('timelineCanvas');
            if (!canvas || State.lifeWheelHistory.length === 0) {
                if (canvas) {
                    const ctx = canvas.getContext('2d');
                    ctx.clearRect(0, 0, 700, 300);
                    ctx.font = '14px -apple-system, sans-serif';
                    ctx.fillStyle = '#B4B4C8';
                    ctx.textAlign = 'center';
                    ctx.fillText('Noch keine Verlaufsdaten', 350, 150);
                }
                renderLegend();
                return;
            }
            
            // Filter data based on view
            let filteredHistory = State.lifeWheelHistory;
            if (State.timelineView === 4) {
                filteredHistory = State.lifeWheelHistory.slice(-4);
            } else if (State.timelineView === 52) {
                filteredHistory = State.lifeWheelHistory.slice(-52);
            }
            // 'all' = no filtering
            
            if (filteredHistory.length === 0) {
                const ctx = canvas.getContext('2d');
                ctx.clearRect(0, 0, 700, 300);
                ctx.font = '14px -apple-system, sans-serif';
                ctx.fillStyle = '#B4B4C8';
                ctx.textAlign = 'center';
                ctx.fillText('Keine Daten fÃ¼r diese Ansicht', 350, 150);
                renderLegend();
                return;
            }
            
            const ctx = canvas.getContext('2d');
            ctx.clearRect(0, 0, 700, 300);
            
            const padding = 50;
            const graphWidth = 700 - padding * 2;
            const graphHeight = 250;
            
            // Y-axis
            ctx.strokeStyle = 'rgba(149, 157, 165, 0.2)';
            ctx.lineWidth = 2;
            ctx.beginPath();
            ctx.moveTo(padding, padding);
            ctx.lineTo(padding, padding + graphHeight);
            ctx.lineTo(700 - padding, padding + graphHeight);
            ctx.stroke();
            
            // Y-axis labels and grid
            ctx.font = '11px -apple-system, sans-serif';
            ctx.fillStyle = '#75758B';
            ctx.textAlign = 'right';
            for (let i = 0; i <= 10; i++) {
                const y = padding + graphHeight - (graphHeight / 10) * i;
                ctx.fillText(i.toString(), padding - 10, y + 4);
                
                // Grid lines
                if (i > 0) {
                    ctx.strokeStyle = 'rgba(149, 157, 165, 0.05)';
                    ctx.lineWidth = 1;
                    ctx.beginPath();
                    ctx.moveTo(padding, y);
                    ctx.lineTo(700 - padding, y);
                    ctx.stroke();
                }
            }
            
            // Lines for each area - ALWAYS draw all 7
            const areas = ['health', 'love', 'social', 'career', 'growth', 'fun', 'finance'];
            let drawnCount = 0;
            
            areas.forEach(key => {
                if (!State.lifeWheel[key]) {
                    console.warn(`Timeline: Missing area ${key}`);
                    return;
                }
                
                const color = State.lifeWheel[key].color;
                ctx.strokeStyle = color;
                ctx.lineWidth = 2.5;
                ctx.lineShadow = `0 0 4px ${color}`;
                ctx.beginPath();
                
                let hasData = false;
                let pointCount = 0;
                
                filteredHistory.forEach((snapshot, index) => {
                    const value = snapshot.values[key];
                    if (value !== undefined && value !== null) {
                        const x = padding + pointSpacing * index;
                        const y = padding + graphHeight - (graphHeight / 10) * value;
                        
                        if (!hasData) {
                            ctx.moveTo(x, y);
                            hasData = true;
                        } else {
                            ctx.lineTo(x, y);
                        }
                        pointCount++;
                    }
                });
                
                if (hasData) {
                    ctx.stroke();
                    drawnCount++;
                    
                    // Draw points
                    filteredHistory.forEach((snapshot, index) => {
                        const value = snapshot.values[key];
                        if (value !== undefined && value !== null) {
                            const x = padding + pointSpacing * index;
                            const y = padding + graphHeight - (graphHeight / 10) * value;
                            
                            ctx.fillStyle = color;
                            ctx.beginPath();
                            ctx.arc(x, y, 4, 0, Math.PI * 2);
                            ctx.fill();
                            
                            // White border around point
                            ctx.strokeStyle = 'white';
                            ctx.lineWidth = 2;
                            ctx.stroke();
                        }
                    });
                } else {
                    console.warn(`Timeline: No data for ${key} (${State.lifeWheel[key].name})`);
                }
            });
            
            console.log(`Timeline rendered: ${drawnCount}/7 lines drawn from ${filteredHistory.length} snapshots`);
            
            // Update snapshot info
            const infoElement = document.getElementById('snapshotAreasCount');
            if (infoElement && filteredHistory.length > 0) {
                const latestSnapshot = filteredHistory[filteredHistory.length - 1];
                const areasInSnapshot = Object.keys(latestSnapshot.values || {}).length;
                infoElement.textContent = `${areasInSnapshot}/7`;
                infoElement.style.color = areasInSnapshot === 7 ? '#10B981' : '#F59E0B';
            }
            
            // X-axis labels (dates)
            ctx.font = '10px -apple-system, sans-serif';
            ctx.fillStyle = '#75758B';
            ctx.textAlign = 'center';
            
            // Show max 10 labels to avoid overlap
            const labelStep = Math.ceil(filteredHistory.length / 10);
            filteredHistory.forEach((snapshot, index) => {
                if (index % labelStep === 0 || index === filteredHistory.length - 1) {
                    const x = padding + pointSpacing * index;
                    const date = new Date(snapshot.date);
                    const dateStr = `${date.getDate()}.${date.getMonth() + 1}`;
                    ctx.fillText(dateStr, x, padding + graphHeight + 16);
                }
            });
            
            renderLegend();
        }

        function renderLegend() {
            const container = document.getElementById('timelineLegend');
            if (!container) return;
            
            let html = '';
            Object.entries(State.lifeWheel).forEach(([key, data]) => {
                html += `
                    <div class="legend-item">
                        <div class="legend-color" style="background: ${data.color};"></div>
                        <div class="legend-label">${data.name}</div>
                    </div>
                `;
            });
            
            container.innerHTML = html;
        }

        function changeTimelineView(view) {
            State.timelineView = view;
            
            // Update button states
            document.querySelectorAll('.timeline-view-btn').forEach(btn => {
                btn.classList.remove('active');
                if (btn.dataset.view == view) {
                    btn.classList.add('active');
                }
            });
            
            saveState();
            renderTimeline();
        }

        // ==================== APPLE HEALTH STYLE RING CARDS ====================
        function renderRingCards() {
            const container = document.getElementById('ringCardsGrid');
            if (!container) return;
            
            let html = '';
            
            Object.entries(State.lifeWheel).forEach(([key, data]) => {
                const current = data.current;
                const target = data.target;
                const percentage = Math.round((current / target) * 100);
                
                // Calculate trend
                let trend = 'â†’';
                let trendClass = 'trend-stable';
                let trendValue = 'Â±0';
                
                if (State.lifeWheelHistory.length >= 2) {
                    const latest = State.lifeWheelHistory[State.lifeWheelHistory.length - 1];
                    const previous = State.lifeWheelHistory[State.lifeWheelHistory.length - 2];
                    
                    if (latest && previous && latest.values[key] !== undefined && previous.values[key] !== undefined) {
                        const diff = latest.values[key] - previous.values[key];
                        if (diff > 0) {
                            trend = 'â†—ï¸';
                            trendClass = 'trend-up';
                            trendValue = `+${diff}`;
                        } else if (diff < 0) {
                            trend = 'â†˜ï¸';
                            trendClass = 'trend-down';
                            trendValue = `${diff}`;
                        }
                    }
                }
                
                html += `
                    <div class="ring-card" onclick="openRingDetail('${key}')">
                        ${createRingSVG(current, target, data.color, 120)}
                        <div class="ring-value">${current}</div>
                        <div class="ring-label">
                            <span>${data.name}</span>
                        </div>
                        <div class="ring-trend-badge ${trendClass}">
                            <span>${trend}</span>
                            <span>${trendValue}</span>
                        </div>
                        <div class="ring-percentage">${percentage}% vom Ziel</div>
                    </div>
                `;
            });
            
            container.innerHTML = html;
        }

        function createRingSVG(current, target, color, size) {
            const radius = (size / 2) - 10;
            const circumference = 2 * Math.PI * radius;
            const progress = (current / target);
            const offset = circumference * (1 - progress);
            
            return `
                <svg class="ring-svg" viewBox="0 0 ${size} ${size}" style="width: ${size}px; height: ${size}px;">
                    <circle
                        cx="${size/2}"
                        cy="${size/2}"
                        r="${radius}"
                        fill="none"
                        stroke="rgba(149, 157, 165, 0.15)"
                        stroke-width="8"
                    />
                    <circle
                        cx="${size/2}"
                        cy="${size/2}"
                        r="${radius}"
                        fill="none"
                        stroke="${color}"
                        stroke-width="10"
                        stroke-linecap="round"
                        stroke-dasharray="${circumference}"
                        stroke-dashoffset="${offset}"
                        transform="rotate(-90 ${size/2} ${size/2})"
                        style="transition: stroke-dashoffset 1s ease-out;"
                    />
                </svg>
            `;
        }

        function openRingDetail(key) {
            const data = State.lifeWheel[key];
            if (!data) return;
            
            document.getElementById('ringDetailTitle').textContent = data.name;
            document.getElementById('ringDetailValue').textContent = data.current;
            document.getElementById('ringDetailPercentage').textContent = `${Math.round((data.current / data.target) * 100)}% vom Ziel`;
            document.getElementById('ringStatCurrent').textContent = data.current;
            document.getElementById('ringStatTarget').textContent = data.target;
            
            // SVG Ring
            document.getElementById('ringDetailSvg').innerHTML = createRingSVG(data.current, data.target, data.color, 160).replace(/<svg[^>]*>|<\/svg>/g, '');
            
            // Calculate trend
            let trendValue = 'Â±0';
            let avg7 = data.current;
            
            if (State.lifeWheelHistory.length >= 2) {
                const latest = State.lifeWheelHistory[State.lifeWheelHistory.length - 1];
                const previous = State.lifeWheelHistory[State.lifeWheelHistory.length - 2];
                
                if (latest && previous && latest.values[key] !== undefined && previous.values[key] !== undefined) {
                    const diff = latest.values[key] - previous.values[key];
                    trendValue = diff > 0 ? `+${diff}` : `${diff}`;
                }
                
                // 7-day average
                const last7 = State.lifeWheelHistory.slice(-7);
                const values = last7.map(s => s.values[key]).filter(v => v !== undefined);
                if (values.length > 0) {
                    avg7 = (values.reduce((sum, v) => sum + v, 0) / values.length).toFixed(1);
                }
            }
            
            document.getElementById('ringStatTrend').textContent = trendValue;
            document.getElementById('ringStatAvg').textContent = avg7;
            
            // History
            let historyHTML = '';
            const last4 = State.lifeWheelHistory.slice(-4);
            last4.forEach(snapshot => {
                const date = new Date(snapshot.date);
                const value = snapshot.values[key];
                if (value !== undefined) {
                    historyHTML += `
                        <div class="ring-history-item">
                            <span class="ring-history-date">${date.toLocaleDateString('de-DE', {day: '2-digit', month: '2-digit'})}</span>
                            <span class="ring-history-value">${value}/${data.target}</span>
                        </div>
                    `;
                }
            });
            
            if (historyHTML) {
                document.getElementById('ringHistory').innerHTML = `
                    <div style="font-size: 13px; font-weight: 600; margin-bottom: 12px; color: var(--text-secondary);">Verlauf (letzte Messungen)</div>
                    ${historyHTML}
                `;
            } else {
                document.getElementById('ringHistory').innerHTML = `
                    <div style="font-size: 13px; color: var(--text-secondary); text-align: center;">Noch keine Verlaufsdaten</div>
                `;
            }
            
            document.getElementById('ringDetailModal').classList.add('active');
            document.body.classList.add('no-scroll');
        }

        function closeRingDetail() {
            document.getElementById('ringDetailModal').classList.remove('active');
            document.body.classList.remove('no-scroll');
        }

        function saveLifeWheelSnapshot() {
            const snapshot = {
                date: new Date().toISOString(),
                values: {}
            };
            
            // Save ALL 7 areas explicitly
            const areas = ['health', 'love', 'social', 'career', 'growth', 'fun', 'finance'];
            areas.forEach(key => {
                if (State.lifeWheel[key] && State.lifeWheel[key].current !== undefined) {
                    snapshot.values[key] = State.lifeWheel[key].current;
                } else {
                    snapshot.values[key] = 0;
                }
            });
            
            const savedCount = Object.keys(snapshot.values).length;
            
            State.lifeWheelHistory.push(snapshot);
            
            // Keep last 100 snapshots
            if (State.lifeWheelHistory.length > 100) {
                State.lifeWheelHistory = State.lifeWheelHistory.slice(-100);
            }
            
            saveState();
            updateDebugInfo();
            renderLifeGrid();
            
            showToast(`ðŸ’¾ Stand gespeichert (${savedCount}/7)`, 'success');
        }
        
        function updateDebugInfo() {
            const debugEl = document.getElementById('debugInfo');
            if (!debugEl) return;
            
            const count = State.lifeWheelHistory.length;
            const latest = State.lifeWheelHistory[count - 1];
            
            if (count === 0) {
                debugEl.innerHTML = 'âŒ Keine Snapshots vorhanden';
                return;
            }
            
            const areasCount = latest ? Object.keys(latest.values).length : 0;
            const date = latest ? new Date(latest.date).toLocaleString('de-DE') : 'N/A';
            
            debugEl.innerHTML = `
                âœ… Snapshots: <strong>${count}</strong><br>
                ðŸ“… Letzter: ${date}<br>
                ðŸ“Š Bereiche im letzten: <strong>${areasCount}/7</strong><br>
                ðŸ’¾ Werte: ${latest ? JSON.stringify(latest.values).substring(0, 50) + '...' : 'N/A'}
            `;
        }

        function updateLifeAreaCurrent(key, value) {
            const numValue = Math.max(0, Math.min(State.lifeWheel[key].target, parseInt(value) || 0));
            const wasCompleted = State.lifeWheel[key].completed || false;
            const target = State.lifeWheel[key].target;
            const isNowCompleted = numValue >= target;
            
            State.lifeWheel[key].current = numValue;
            
            // Check for first-time completion
            if (!wasCompleted && isNowCompleted) {
                State.lifeWheel[key].completed = true;
                celebrateRingCompletion(key);
            } else if (wasCompleted && !isNowCompleted) {
                // If they go back below target, remove completed status
                State.lifeWheel[key].completed = false;
            }
            
            // Update display
            const badge = document.getElementById('val-' + key);
            if (badge) badge.textContent = numValue;
            
            // Update big value display
            const card = badge?.closest('.life-card');
            if (card) {
                const valueEl = card.querySelector('.life-value');
                if (valueEl) valueEl.textContent = numValue;
            }
            
            renderRadarChart();
            renderLifeWheel();
            renderLifeGrid();
            saveState();
        }

        function celebrateRingCompletion(key) {
            const data = State.lifeWheel[key];
            
            // Confetti explosion
            createConfetti();
            
            // Sparkles animation
            createSparkles(key);
            
            // Special toast
            showToast(`ðŸ† RING GESCHLOSSEN! ${data.name} Ziel erreicht! ðŸŽ‰`, 'success');
            
            // Sound effect
            playCompletionSound();
        }

        function createSparkles(key) {
            const card = document.getElementById(`life-card-${key}`);
            if (!card) return;
            
            const rect = card.getBoundingClientRect();
            const container = document.createElement('div');
            container.className = 'completion-sparkles';
            document.body.appendChild(container);
            
            const sparkleEmojis = ['âœ¨', 'â­', 'ðŸŒŸ', 'ðŸ’«', 'ðŸŽ†', 'ðŸŽ‡'];
            
            for (let i = 0; i < 12; i++) {
                const sparkle = document.createElement('div');
                sparkle.className = 'sparkle';
                sparkle.textContent = sparkleEmojis[Math.floor(Math.random() * sparkleEmojis.length)];
                
                const angle = (Math.PI * 2 * i) / 12;
                const distance = 100 + Math.random() * 50;
                const tx = Math.cos(angle) * distance;
                const ty = Math.sin(angle) * distance;
                
                sparkle.style.left = (rect.left + rect.width / 2) + 'px';
                sparkle.style.top = (rect.top + rect.height / 2) + 'px';
                sparkle.style.setProperty('--tx', tx + 'px');
                sparkle.style.setProperty('--ty', ty + 'px');
                
                container.appendChild(sparkle);
            }
            
            setTimeout(() => container.remove(), 1500);
        }

        function playCompletionSound() {
            try {
                const audioContext = new (window.AudioContext || window.webkitAudioContext)();
                const oscillator = audioContext.createOscillator();
                const gainNode = audioContext.createGain();
                
                oscillator.connect(gainNode);
                gainNode.connect(audioContext.destination);
                
                oscillator.frequency.value = 800;
                oscillator.type = 'sine';
                
                gainNode.gain.setValueAtTime(0.3, audioContext.currentTime);
                gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.5);
                
                oscillator.start(audioContext.currentTime);
                oscillator.stop(audioContext.currentTime + 0.5);
            } catch (e) {
                // Audio not available
            }
        }

        function updateLifeAreaTarget(key, value) {
            const numValue = Math.max(1, Math.min(10, parseInt(value) || 10));
            State.lifeWheel[key].target = numValue;
            
            // Adjust current if it exceeds new target
            if (State.lifeWheel[key].current > numValue) {
                State.lifeWheel[key].current = numValue;
            }
            
            renderRadarChart();
            renderLifeWheel();
            renderLifeGrid();
            saveState();
        }

        // Keep old function for backward compatibility
        function updateLifeArea(key, value) {
            updateLifeAreaCurrent(key, value);
        }

        function createConfetti() {
            const colors = ['#FF9966', '#FF7744', '#FFD700', '#FFA500'];
            
            for (let i = 0; i < 60; i++) {
                const confetti = document.createElement('div');
                confetti.className = 'confetti';
                confetti.style.left = Math.random() * 100 + 'vw';
                confetti.style.top = Math.random() * -20 + 'vh';
                confetti.style.background = colors[Math.floor(Math.random() * colors.length)];
                confetti.style.animation = `confettiFall ${(Math.random() * 2 + 2)}s linear forwards`;
                confetti.style.animationDelay = Math.random() * 0.5 + 's';
                
                document.body.appendChild(confetti);
                setTimeout(() => confetti.remove(), 4000);
            }
        }

        // ==================== GOALS RENDERING ====================
        function renderFocusGoal() {
            const container = document.getElementById('focusGoalContainer');
            if (!State.focusGoalId) {
                container.innerHTML = `
                    <div class="no-focus">
                        <div class="no-focus-text">Kein Fokusziel gesetzt</div>
                    </div>
                `;
                return;
            }

            const goal = [...State.goals['five-year'], ...State.goals['yearly'], ...State.goals['quarterly']]
                .find(g => g.id === State.focusGoalId);
            
            if (!goal) {
                State.focusGoalId = null;
                renderFocusGoal();
                return;
            }

            const daysLeft = Math.ceil((new Date(goal.endDate) - new Date()) / (1000 * 60 * 60 * 24));
            const tagIcons = goal.tags.map(t => State.big5[t].icon).join(' ');

            container.innerHTML = `
                <div class="focus-goal" onclick="editGoal('quarterly', ${goal.id})">
                    <div class="focus-label">â­ FOKUSZIEL</div>
                    <div class="focus-title">${goal.title}</div>
                    <div class="focus-meta">
                        <div>${daysLeft >= 0 ? daysLeft + ' Tage' : 'ÃœberfÃ¤llig'}</div>
                    </div>
                    <div class="focus-progress-bar">
                        <div class="focus-progress-fill" style="width: ${goal.progress}%;"></div>
                    </div>
                    <div class="focus-progress-text">${goal.progress}% erreicht</div>
                </div>
            `;
        }

        function renderBig5Filter() {
            const container = document.getElementById('big5Filter');
            let html = `
                <div class="filter-chip ${State.selectedBig5Filter === 'all' ? 'active' : ''}" onclick="filterByBig5('all')">
                    <span>Alle</span>
                </div>
            `;
            
            Object.entries(State.big5).forEach(([key, data]) => {
                html += `
                    <div class="filter-chip ${State.selectedBig5Filter === key ? 'active' : ''}" onclick="filterByBig5('${key}')">
                        <i data-lucide="${data.icon}"></i>
                        <span>${data.name}</span>
                    </div>
                `;
            });
            
            container.innerHTML = html;
            lucide.createIcons();
        }

        function filterByBig5(key) {
            State.selectedBig5Filter = key;
            renderBig5Filter();
            renderGoalsList();
        }

        function renderGoalsList() {
            const container = document.getElementById('goalsList');
            let html = '';
            
            ['five-year', 'yearly', 'quarterly'].forEach(type => {
                const titles = { 'five-year': '5-Jahres-ZustÃ¤nde', 'yearly': 'Jahresziele', 'quarterly': 'Quartalsziele' };
                
                let goals = State.goals[type];
                if (State.selectedBig5Filter !== 'all') {
                    goals = goals.filter(g => g.tags.includes(State.selectedBig5Filter));
                }
                
                html += `
                    <div class="goals-section">
                        <div class="section-header">
                            <div class="section-title-small">${titles[type]}</div>
                            <button class="add-btn" onclick="openGoalModal('${type}')">
                                <i data-lucide="plus"></i>
                            </button>
                        </div>
                `;
                
                if (goals.length === 0) {
                    html += `<div class="empty-state">Keine Ziele vorhanden</div>`;
                } else {
                    goals.forEach(goal => {
                        const isFocus = State.focusGoalId === goal.id;
                        const canFocus = type === 'quarterly';
                        
                        html += `
                            <div class="glass-card goal-card" onclick="editGoal('${type}', ${goal.id})">
                                <div class="goal-header">
                                    <div class="goal-title-row">
                                        <div class="goal-icon-small">
                                            <i data-lucide="${goal.icon}"></i>
                                        </div>
                                        <div class="goal-title">${goal.title}</div>
                                    </div>
                                    ${canFocus ? `
                                        <div class="goal-actions" onclick="event.stopPropagation(); toggleFocus(${goal.id})">
                                            <i data-lucide="${isFocus ? 'star' : 'star'}" class="goal-action-icon ${isFocus ? 'focus' : ''}" style="${isFocus ? 'fill: var(--primary);' : ''}"></i>
                                        </div>
                                    ` : ''}
                                </div>
                                ${goal.description ? `<div class="goal-description">${goal.description}</div>` : ''}
                                <div class="goal-meta-row">
                                    <div>${new Date(goal.endDate).toLocaleDateString('de-DE')}</div>
                                    ${type !== 'five-year' && goal.tags.length > 0 ? `
                                        <div class="goal-tags">
                                            ${goal.tags.map(t => `<span class="goal-tag">${State.big5[t].name}</span>`).join('')}
                                        </div>
                                    ` : ''}
                                </div>
                                <div class="goal-progress-row">
                                    <div class="goal-progress-bar">
                                        <div class="goal-progress-fill" style="width: ${goal.progress}%;"></div>
                                    </div>
                                    <div class="goal-progress-text">${goal.progress}%</div>
                                </div>
                            </div>
                        `;
                    });
                }
                
                html += `</div>`;
            });
            
            container.innerHTML = html;
            lucide.createIcons();
        }

        // ==================== GOAL MODAL ====================
        function openGoalModal(type) {
            State.editingGoalType = type;
            State.editingGoalId = null;
            State.currentGoalIcon = 'star';
            
            document.getElementById('goalModalTitle').textContent = type === 'five-year' ? '5-Jahres-Zustand' : type === 'yearly' ? 'Jahresziel' : 'Quartalsziel';
            document.getElementById('goalForm').reset();
            document.getElementById('goalProgressValue').textContent = '0';
            document.getElementById('goalDeleteBtn').style.display = 'none';
            
            // Icon zurÃ¼cksetzen
            updateGoalIconDisplay(State.currentGoalIcon);
            
            // Big 5 selector
            const isFiveYear = type === 'five-year';
            document.getElementById('big5SelectGroup').style.display = isFiveYear ? 'block' : 'none';
            document.getElementById('big5MultiGroup').style.display = isFiveYear ? 'none' : 'block';
            
            // Populate Big 5 options
            const singleSelect = document.getElementById('goalBig5Single');
            singleSelect.innerHTML = '<option value="">WÃ¤hlen...</option>';
            Object.entries(State.big5).forEach(([key, data]) => {
                singleSelect.innerHTML += `<option value="${key}">${data.icon} ${data.name}</option>`;
            });
            
            // Populate checkboxes
            const checkboxes = document.getElementById('big5Checkboxes');
            checkboxes.innerHTML = '';
            checkboxes.className = 'checkbox-group';
            Object.entries(State.big5).forEach(([key, data]) => {
                checkboxes.innerHTML += `
                    <div class="checkbox-item">
                        <input type="checkbox" id="tag-${key}" value="${key}">
                        <label for="tag-${key}">${data.name}</label>
                    </div>
                `;
            });
            
            document.getElementById('goalModal').classList.add('active');
            document.body.classList.add('no-scroll');
        }

        function closeGoalModal() {
            document.getElementById('goalModal').classList.remove('active');
            document.body.classList.remove('no-scroll');
            State.editingGoalType = null;
            State.editingGoalId = null;
        }

        function editGoal(type, id) {
            const goal = State.goals[type].find(g => g.id === id);
            if (!goal) return;
            
            State.editingGoalType = type;
            State.editingGoalId = id;
            State.currentGoalIcon = goal.icon || 'star';
            
            // Setup modal without resetting
            document.getElementById('goalModalTitle').textContent = 'Ziel bearbeiten';
            document.getElementById('goalDeleteBtn').style.display = 'block';
            
            const isFiveYear = type === 'five-year';
            document.getElementById('big5SelectGroup').style.display = isFiveYear ? 'block' : 'none';
            document.getElementById('big5MultiGroup').style.display = isFiveYear ? 'none' : 'block';
            
            // Populate Big 5 options
            const singleSelect = document.getElementById('goalBig5Single');
            singleSelect.innerHTML = '<option value="">WÃ¤hlen...</option>';
            Object.entries(State.big5).forEach(([key, data]) => {
                singleSelect.innerHTML += `<option value="${key}">${data.name}</option>`;
            });
            
            // Populate checkboxes
            const checkboxes = document.getElementById('big5Checkboxes');
            checkboxes.innerHTML = '';
            checkboxes.className = 'checkbox-group';
            Object.entries(State.big5).forEach(([key, data]) => {
                checkboxes.innerHTML += `
                    <div class="checkbox-item">
                        <input type="checkbox" id="tag-${key}" value="${key}">
                        <label for="tag-${key}">${data.name}</label>
                    </div>
                `;
            });
            
            // NOW set the values AFTER populating
            document.getElementById('goalTitle').value = goal.title;
            document.getElementById('goalDescription').value = goal.description || '';
            document.getElementById('goalEndDate').value = goal.endDate;
            document.getElementById('goalProgress').value = goal.progress;
            document.getElementById('goalProgressValue').textContent = goal.progress;
            
            updateGoalIconDisplay(State.currentGoalIcon);
            
            if (isFiveYear) {
                document.getElementById('goalBig5Single').value = goal.tags[0] || '';
            } else {
                goal.tags.forEach(tag => {
                    const checkbox = document.getElementById(`tag-${tag}`);
                    if (checkbox) checkbox.checked = true;
                });
            }
            
            // Open modal
            document.getElementById('goalModal').classList.add('active');
            document.body.classList.add('no-scroll');
        }

        function saveGoal(event) {
            event.preventDefault();
            
            console.log('=== SAVE GOAL DEBUG ===');
            console.log('State.editingGoalType:', State.editingGoalType);
            console.log('State.editingGoalId:', State.editingGoalId);
            
            const title = document.getElementById('goalTitle').value;
            const description = document.getElementById('goalDescription').value;
            const endDate = document.getElementById('goalEndDate').value;
            const progress = parseInt(document.getElementById('goalProgress').value);
            
            console.log('Title:', title);
            console.log('EndDate:', endDate);
            console.log('Progress:', progress);
            
            let tags = [];
            if (State.editingGoalType === 'five-year') {
                const selectedBig5 = document.getElementById('goalBig5Single').value;
                console.log('Five-year selected Big5:', selectedBig5);
                if (!selectedBig5) {
                    alert('Bitte wÃ¤hle einen Bereich!');
                    return;
                }
                tags = [selectedBig5];
            } else {
                document.querySelectorAll('#big5Checkboxes input:checked').forEach(cb => {
                    tags.push(cb.value);
                });
                console.log('Yearly/Quarterly tags:', tags);
                if (tags.length === 0) {
                    alert('Bitte wÃ¤hle mindestens einen Bereich!');
                    return;
                }
            }
            
            const wasComplete = State.editingGoalId ? 
                State.goals[State.editingGoalType].find(g => g.id === State.editingGoalId)?.progress === 100 : false;
            
            const goal = {
                id: State.editingGoalId || Date.now(),
                title,
                description,
                tags,
                progress,
                endDate,
                icon: State.currentGoalIcon
            };
            
            console.log('Goal object:', goal);
            
            if (State.editingGoalId) {
                const index = State.goals[State.editingGoalType].findIndex(g => g.id === State.editingGoalId);
                console.log('Updating goal at index:', index);
                State.goals[State.editingGoalType][index] = goal;
            } else {
                console.log('Creating new goal');
                State.goals[State.editingGoalType].push(goal);
            }
            
            console.log('Goals after save:', State.goals);
            
            saveState();
            renderGoalsList();
            renderFocusGoal();
            closeGoalModal();
            
            if (!wasComplete && progress === 100) {
                createConfetti();
                showToast('ðŸŽ‰ Ziel abgeschlossen!', 'success');
            } else if (State.editingGoalId) {
                showToast('âœ… Ziel aktualisiert', 'success');
            } else {
                showToast('âœ… Ziel erstellt', 'success');
            }
            
            console.log('=== SAVE GOAL COMPLETE ===');
        }

        function deleteGoal() {
            if (!confirm('Ziel wirklich lÃ¶schen?')) return;
            
            const goalTitle = State.goals[State.editingGoalType].find(g => g.id === State.editingGoalId)?.title;
            
            State.goals[State.editingGoalType] = State.goals[State.editingGoalType]
                .filter(g => g.id !== State.editingGoalId);
            
            if (State.focusGoalId === State.editingGoalId) {
                State.focusGoalId = null;
            }
            
            saveState();
            renderGoalsList();
            renderFocusGoal();
            closeGoalModal();
            
            showToast('ðŸ—‘ï¸ Ziel gelÃ¶scht', 'error');
        }

        function updateGoalProgressValue(value) {
            document.getElementById('goalProgressValue').textContent = value;
        }

        // ==================== ICON PICKER ====================
        function openIconPickerForGoal() {
            State.currentIconTarget = 'goal';
            renderIconPicker();
            document.getElementById('iconModal').classList.add('active');
            document.body.classList.add('no-scroll');
        }

        function openIconPickerForBig5(key) {
            State.currentIconTarget = key;
            renderIconPicker();
            document.getElementById('iconModal').classList.add('active');
            document.body.classList.add('no-scroll');
        }

        function renderIconPicker() {
            const grid = document.getElementById('iconGrid');
            let html = '';
            
            lucideIcons.forEach(icon => {
                html += `
                    <div class="icon-option" onclick="selectIcon('${icon}')">
                        <i data-lucide="${icon}"></i>
                    </div>
                `;
            });
            
            grid.innerHTML = html;
            lucide.createIcons();
        }

        function selectIcon(icon) {
            if (State.currentIconTarget === 'goal') {
                State.currentGoalIcon = icon;
                updateGoalIconDisplay(icon);
            } else {
                // Big 5 icon change
                State.big5[State.currentIconTarget].icon = icon;
                saveState();
                renderBig5Grid();
                renderBig5Filter();
                renderGoalsList();
            }
            closeIconModal();
        }

        function updateGoalIconDisplay(icon) {
            const iconEl = document.getElementById('selectedGoalIcon');
            if (iconEl) {
                iconEl.innerHTML = `<i data-lucide="${icon}"></i>`;
                lucide.createIcons();
            }
        }

        function closeIconModal() {
            document.getElementById('iconModal').classList.remove('active');
            document.body.classList.remove('no-scroll');
            State.currentIconTarget = null;
        }

        function toggleFocus(goalId) {
            State.focusGoalId = State.focusGoalId === goalId ? null : goalId;
            saveState();
            renderFocusGoal();
            renderGoalsList();
        }

        // ==================== NAVIGATION ====================
        document.querySelectorAll('.nav-item').forEach(btn => {
            btn.addEventListener('click', () => {
                const tab = btn.dataset.tab;
                
                document.querySelectorAll('.nav-item').forEach(b => b.classList.remove('active'));
                btn.classList.add('active');
                
                document.querySelectorAll('.tab-content').forEach(t => t.classList.remove('active'));
                document.getElementById(tab).classList.add('active');
                
                if (tab === 'lifewheel') {
                    setTimeout(() => {
                        renderRadarChart();
                        renderLifeWheel();
                        renderLifeGrid();
                        updateDebugInfo();
                    }, 100);
                }
                
                if (tab === 'goals') {
                    setTimeout(() => {
                        renderFocusGoal();
                        renderBig5Filter();
                        renderGoalsList();
                    }, 100);
                }
                
                lucide.createIcons();
            });
        });

        // ==================== SETTINGS ====================
        function openSettings() {
            document.getElementById('darkModeToggle').checked = State.darkMode;
            document.getElementById('settingsModal').classList.add('active');
            document.body.classList.add('no-scroll');
            lucide.createIcons();
        }

        function closeSettings() {
            document.getElementById('settingsModal').classList.remove('active');
            document.body.classList.remove('no-scroll');
        }

        function toggleDarkMode() {
            State.darkMode = document.getElementById('darkModeToggle').checked;
            
            if (State.darkMode) {
                document.body.classList.add('dark-mode');
                showToast('ðŸŒ™ Dark Mode aktiviert', 'success');
            } else {
                document.body.classList.remove('dark-mode');
                showToast('â˜€ï¸ Light Mode aktiviert', 'success');
            }
            
            saveState();
        }

        function exportData() {
            try {
                const exportData = {
                    version: '2.0',
                    exportDate: new Date().toISOString(),
                    data: State
                };
                
                const dataStr = JSON.stringify(exportData, null, 2);
                const dataBlob = new Blob([dataStr], { type: 'application/json' });
                
                const link = document.createElement('a');
                link.href = URL.createObjectURL(dataBlob);
                link.download = `42life-backup-${new Date().toISOString().split('T')[0]}.json`;
                link.click();
                
                showToast('ðŸ’¾ Backup erstellt!', 'success');
            } catch (e) {
                console.error('Export error:', e);
                showToast('âŒ Export fehlgeschlagen', 'error');
            }
        }

        function importData(event) {
            const file = event.target.files[0];
            if (!file) return;
            
            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const imported = JSON.parse(e.target.result);
                    
                    if (!imported.data) {
                        throw new Error('Invalid backup format');
                    }
                    
                    // Restore data
                    if (imported.data.big5) Object.assign(State.big5, imported.data.big5);
                    if (imported.data.lifeWheel) Object.assign(State.lifeWheel, imported.data.lifeWheel);
                    if (imported.data.lifeWheelHistory) State.lifeWheelHistory = imported.data.lifeWheelHistory;
                    if (imported.data.goals) State.goals = imported.data.goals;
                    if (imported.data.focusGoalId !== undefined) State.focusGoalId = imported.data.focusGoalId;
                    if (imported.data.darkMode !== undefined) {
                        State.darkMode = imported.data.darkMode;
                        if (State.darkMode) {
                            document.body.classList.add('dark-mode');
                        }
                    }
                    
                    saveState();
                    
                    // Re-render everything
                    renderBig5Grid();
                    renderLifeWheel();
                    renderLifeGrid();
                    renderTimeline();
                    renderFocusGoal();
                    renderBig5Filter();
                    renderGoalsList();
                    lucide.createIcons();
                    
                    closeSettings();
                    showToast('âœ… Import erfolgreich!', 'success');
                    
                    console.log('âœ… Imported from:', imported.exportDate);
                } catch (e) {
                    console.error('Import error:', e);
                    showToast('âŒ Import fehlgeschlagen - ungÃ¼ltige Datei', 'error');
                }
            };
            
            reader.readAsText(file);
            event.target.value = ''; // Reset input
        }

        function confirmReset() {
            const confirmText = prompt('âš ï¸ WARNUNG: Alle Daten werden gelÃ¶scht!\n\nTippe "LÃ–SCHEN" zum BestÃ¤tigen:');
            
            if (confirmText === 'LÃ–SCHEN') {
                localStorage.removeItem('42life_premium');
                showToast('ðŸ—‘ï¸ Alle Daten gelÃ¶scht', 'error');
                setTimeout(() => {
                    location.reload();
                }, 1500);
            } else if (confirmText) {
                showToast('âŒ Abgebrochen - falsche Eingabe', 'error');
            }
        }

        // ==================== STORAGE ====================
        function saveState() {
            try {
                const serialized = JSON.stringify(State);
                localStorage.setItem('42life_premium', serialized);
            } catch (e) {
                if (e.name === 'QuotaExceededError') {
                    console.error('âŒ LocalStorage quota exceeded!');
                    showToast('âš ï¸ Speicher voll! Bitte alte Verlaufsdaten lÃ¶schen', 'error');
                } else {
                    console.error('âŒ Error saving state:', e);
                    showToast('âš ï¸ Fehler beim Speichern', 'error');
                }
            }
        }

        function loadState() {
            const saved = localStorage.getItem('42life_premium');
            if (saved) {
                try {
                    const data = JSON.parse(saved);
                    if (data.big5) Object.assign(State.big5, data.big5);
                    if (data.lifeWheel) Object.assign(State.lifeWheel, data.lifeWheel);
                    if (data.lifeWheelHistory) State.lifeWheelHistory = data.lifeWheelHistory;
                    if (data.goals) State.goals = data.goals;
                    if (data.focusGoalId !== undefined) State.focusGoalId = data.focusGoalId;
                    if (data.selectedBig5Filter) State.selectedBig5Filter = data.selectedBig5Filter;
                    if (data.darkMode !== undefined) {
                        State.darkMode = data.darkMode;
                        if (State.darkMode) {
                            document.body.classList.add('dark-mode');
                        }
                    }
                    if (data.timelineView !== undefined) {
                        State.timelineView = data.timelineView;
                    }
                    console.log('âœ… State loaded successfully');
                } catch (e) {
                    console.error('âŒ Error loading state:', e);
                    showToast('âš ï¸ Fehler beim Laden - Demo-Daten werden geladen', 'error');
                    loadDemoGoals();
                }
            } else {
                // First time - load demo goals
                console.log('ðŸ“¦ First load - loading demo goals');
                loadDemoGoals();
            }
        }

        // ==================== INIT ====================
        console.log('=== 42LIFE PREMIUM INIT ===');
        
        // Keyboard Navigation
        document.addEventListener('keydown', (e) => {
            // ESC to close modals
            if (e.key === 'Escape') {
                if (document.getElementById('goalModal').classList.contains('active')) {
                    closeGoalModal();
                } else if (document.getElementById('iconModal').classList.contains('active')) {
                    closeIconModal();
                } else if (document.getElementById('levelModal').classList.contains('active')) {
                    closeLevelModal();
                } else if (document.getElementById('settingsModal').classList.contains('active')) {
                    closeSettings();
                } else if (document.getElementById('ringDetailModal').classList.contains('active')) {
                    closeRingDetail();
                }
            }
            
            // Enter to submit in Level Modal
            if (e.key === 'Enter' && document.getElementById('levelModal').classList.contains('active')) {
                if (document.activeElement.tagName === 'INPUT') {
                    confirmLevelUp();
                }
            }
        });
        
        // Debug function - call in console: resetApp()
        window.resetApp = function() {
            if (confirm('App zurÃ¼cksetzen und Demo-Daten laden?')) {
                localStorage.removeItem('42life_premium');
                location.reload();
            }
        };
        
        // Clear data for testing - call in console: clearData()
        window.clearData = function() {
            if (confirm('âš ï¸ ALLE DATEN LÃ–SCHEN (fÃ¼r Import-Test)?')) {
                localStorage.removeItem('42life_premium');
                
                // Reset to empty state
                State.big5 = {
                    entrepreneur: { name: 'Entrepreneur', icon: 'rocket', level: 1, levelDescription: '', nextMilestone: 'Erstes Produkt launchen' },
                    books: { name: 'Book Author', icon: 'book-open', level: 1, levelDescription: '', nextMilestone: 'Erstes Buch schreiben' },
                    food: { name: 'Food Ambassador', icon: 'salad', level: 1, levelDescription: '', nextMilestone: 'Ersten Workshop halten' },
                    family: { name: 'Happy Family', icon: 'heart', level: 1, levelDescription: '', nextMilestone: 'Quality Time etablieren' },
                    world: { name: 'World Explorer', icon: 'globe', level: 1, levelDescription: '', nextMilestone: '10 LÃ¤nder bereisen' }
                };
                State.goals = { 'five-year': [], 'yearly': [], 'quarterly': [] };
                State.focusGoalId = null;
                State.lifeWheelHistory = [];
                
                saveState();
                
                // Re-render
                renderBig5Grid();
                renderLifeWheel();
                renderLifeGrid();
                renderTimeline();
                renderFocusGoal();
                renderBig5Filter();
                renderGoalsList();
                lucide.createIcons();
                
                showToast('ðŸ—‘ï¸ Alle Daten gelÃ¶scht - bereit fÃ¼r Import-Test!', 'success');
                console.log('âœ… Data cleared - ready for import test');
            }
        };
        
        loadState();
        console.log('Goals loaded:', State.goals);
        console.log('Focus goal:', State.focusGoalId);
        
        renderBig5Grid();
        renderRadarChart();
        renderLifeWheel();
        renderLifeGrid();
        renderFocusGoal();
        renderBig5Filter();
        renderGoalsList();
        lucide.createIcons();
        
        console.log('=== INIT COMPLETE ===');
        console.log('Tipp: Zum ZurÃ¼cksetzen in Console eingeben: resetApp()');
        console.log('Tipp: Daten lÃ¶schen fÃ¼r Import-Test: clearData()');
        console.log('Tipp: ESC schlieÃŸt Modals, Enter bestÃ¤tigt');
    </script>
</body>
</html>
